%
%  $Description: Author guidelines and sample document in LaTeX 2.09/2e$
%
%  $Author: Priit Ruberg$
%  $Date: 2015/02/09 $
%  $Revision: 2.5 $
%
%  Translated to English 2017/03/10 by Chris Raastad
%
\documentclass[12pt]{article} %Document class definition and text size settings
%
%Packages can be explored in more details: https://www.ctan.org/pkg/PACKAGE_NAME?lang=en
%
\usepackage{graphicx} %Allow using graphics in the text
\usepackage[top=2.5cm, bottom=2.5cm, left=3cm, right=3cm]{geometry} %Set the page margins
\usepackage{titlesec} %Package for title style
\usepackage{longtable} %Package so tables can be longer than one page
\usepackage{multirow} %Package so table cells can span multiple rows
\usepackage[colorinlistoftodos]{todonotes} %Package so you can add nice TODO marks in your paper with \todo{TODO text...}
\usepackage{cite} %For Bibtex

\usepackage{hyperref}
% \usepackage{url} %Package in order to nicely use URLs
\usepackage{float} %Package to improves interface for defining floating objects like figures and tables

\usepackage[english, estonian]{babel} %Specifies possible languages of the document: English, Russian, and Estonian
	\addto\captionsestonian{\def\refname{\centerline{References}}} %Changes references name and makes it center
	\addto\captionsestonian{\def\listfigurename{\centerline{List of figures}}} %Changes drawing list name and makes it center
	\addto\captionsestonian{\def\listtablename{\centerline{List of tables}}} %Changes table list name makes it center
	\addto\captionsestonian{\def\contentsname{\centerline{Table of contents}}}
\usepackage[T2A,T1]{fontenc} %Font encodings for Russian and Estonian letters
\usepackage[utf8]{inputenc} %use UTF8 decodings

\usepackage{tocloft} %Control table of contents, tables, etc.
%\setlength\cftparskip{-2pt}
%\setlength\cftbeforechapskip{0pt}

\usepackage{amssymb} %For square itemized listss
\renewcommand{\labelitemi}{\tiny$\blacksquare$} %For square itemized lists


\usepackage{caption} %Needed to customise captions for tables and figures
\captionsetup{labelsep=period} %Set table and figure caption name to be separated with text with a period

\usepackage{verbatimbox} %To put program code in the center using Verbatim

\titlelabel{\thetitle.\quad} %Adds periods to the end of titles

\usepackage{times} %Sets font to Times New Roman
\usepackage{fancyhdr} %Allows more control of headers and footers
\setlength{\parindent}{0cm} %Set paragraph indentation to zero
\usepackage{setspace} %Allows setting spacing between lines
\onehalfspacing %Set spacing to 1.5x
\usepackage{parskip}
\setlength{\parskip}{\baselineskip}
%\hangindent=0.7cm

\hyphenation{põhi-tekstis üliõpilas-kood lehe-küljed joonda-takse} %Correcting incorrect hyphenation (?)

\usepackage{eurosym}
\usepackage{quoting} %for quoting format
\quotingsetup{vskip=0pt} %for no vertical whitespace around quotings

% a bunch of stuff to make paragraph act as a subsubsubsection and numbered and formatted correctly
\usepackage{titlesec}
\setcounter{secnumdepth}{4}
\titleformat{\paragraph}
{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{}
\titlespacing*{\paragraph}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

\usepackage{enumerate} %for more control of ordered lists

\usepackage[none]{hyphenat} %kill hyphenation

% --- new commands ---

% creates hyperref using the name of a section
\newcommand{\hypernameref}[1]{\hyperref[#1]{\nameref{#1}}}

% creates a hyperref in form "Table #" to a table
\newcommand{\hypertableref}[1]{\hyperref[#1]{Table \ref{#1}}}

% creates a hyperref in form "Section #" to a table
\newcommand{\hypersectionref}[1]{\hyperref[#1]{Section \ref{#1}}}

% make font look like code
\def\code#1{\texttt{#1}}

% ability to add line breaks in tables (by making a new table...)
% http://tex.stackexchange.com/questions/2441/how-to-add-a-forced-line-break-inside-a-table-cell
\newcommand{\specialcell}[2][c]{%
  \begin{tabular}[#1]{@{}l@{}}#2\end{tabular}}

\begin{document}
\selectlanguage{english}

%------------------------------ENGLISH TITLE PAGE---------------------------------
\thispagestyle{fancy} %Page will include header and footer
\renewcommand{\headrulewidth}{0pt} %Remove header horizontal line
\renewcommand{\footrulewidth}{0pt} %Remove footer horizontal line
\headheight = 57pt %Set header heght (with regards to compiler suggestion)
\footskip = 11pt %Footer space
\headsep = 0pt %Decrease header and text line spacing distance to zero

\chead{ %Place the following text header to the center
 \textsc{\begin{Large} %Make the following text have big letters
	TALLINN UNIVERSITY OF TECHNOLOGY\\
	\end{Large}}
	Faculty of Information Technology\\
	Department of Computer Engineering
}
\vspace*{7 cm} %Make the page beginning and text line spacing correspond to the width

\begin{center} %Text centered
ITC70LT\\[0cm]
Christopher David Raastad\\
\begin{LARGE}
\textsc{Security, Scalability, and Privacy Analysis of the Euro 2.0 Digital Currency\\}
\end{LARGE}
Master thesis\\[2cm]
\end{center}

\begin{flushright} %Align text to the right
Alex Norta\\[0cm]
PhD\\[0cm]
Associated Professor\\[0cm]
\end{flushright}

\cfoot{Tallinn 2017} %Add location and year to the header
%\renewcommand{\headrulewidth}{0pt} %Remove the footer horizontal line
\pagebreak %End of page

%------------------------------TIITELLEHT EESTI KEELES---------------------------------
\selectlanguage{estonian}
\thispagestyle{fancy} %Leht sisaldab päist ja jalust
\renewcommand{\headrulewidth}{0pt} %Eemaldab päisest horisontaalse joone
\renewcommand{\footrulewidth}{0pt} %Eemaldab jalusest horisontaalse joone
\headheight = 57pt %Paneb paika päise laiuse (vastavalt kompilaatori soovitusele)
\footskip = 11pt %Jaluse ruum
\headsep = 0pt %Vähendab päise ja teksti vahelise kauguse nullini

\chead{ %Paigutab järgneva teksti päises keskele
 \textsc{\begin{Large} %Tekst suurtähtedega ja suuremaks
	tallinna tehnikaülikool\\
	\end{Large}}
	Infotehnoloogia teaduskond\\
	Arvutitehnika instituut
}
\vspace*{7 cm} %Tekitab lehe alguse ja teksti vahele tühja ala vastava laiusega

\begin{center} %Tekst keskele
ITC70LT\\[0cm]
Christopher David Raastad\\
\begin{LARGE}
\textsc{Euro 2.0 Digitaalne Valuuta Turvalisuse, Skaleeritamise, ja Privaatsuse Analüüs\\}
\end{LARGE}
Magister\\[2cm]
\end{center}

\begin{flushright} %Joondab teksti paremale
Alex Norta\\[0cm]  \todo[noline]{Tõlgi PhD eesti keelde}
PhD\\[0cm]
Associate Professor\\[0cm]  \todo[noline]{Tõlgi Associated Professor eesti keelde}
\end{flushright}

\cfoot{Tallinn 2015} %Lisab asukoha ja kuupäeva jalusesse
%\renewcommand{\headrulewidth}{0pt} %Eemaldab päisest horisontaalse joone
\pagebreak %Lehe lõpp


%----------------------------LIST OF TODOS----------------------------------
\listoftodos
\newpage

%---------------------------AUTHOR DECLARATION-------------------------
\selectlanguage{english}
\section*{\begin{center}
 Author’s declaration of originality
\end{center}}
I hereby certify that I am the sole author of this thesis. All the used materials, references to the literature and the work of others have been referred to. This thesis has not been presented for examination anywhere else.

Author: Christopher David Raastad

May 8th 2017
\pagebreak

%---------------------------ABSTRACT---------------------------------
\selectlanguage{estonian}
\section*{\begin{center}
Abstract
\end{center}}

\todo[inline]{Write English abstract \ldots}

If the thesis is written in English, the abstract is $\frac{1}{2}$ A4 long and the abstract in Estonian (\textit{Annotatsioon}) is of length 1 A4.

The last paragraph of abstract is obligatory and must be written accordingly:

\todo[inline]{Fill in English abstract thesis details \ldots}

The thesis is in English and contains [pages] pages of text, [chapters] chapters, [figures] figures, [tables] tables.

\pagebreak

%-----------------------------ANNOTATSIOON-----------------------------------
\section*{\begin{center}
Annotatsioon
\end{center}}

\todo[inline]{Kirjuta annotatsiooni eesti keeles \ldots}

Kui töö põhikeel on inglise keel, siis esitatakse annotatsioon (Abstract) inglise keeles mahuga $\frac{1}{2}$ A4 lehekülge ja annotatsioon eesti keeles mahuga vähemalt 1 A4 lehekülg.

Annotatsiooni viimane lõik on kohustuslik ja omab järgmist sõnastust:

\todo[inline]{Täitke eesti keele annotatsiooni lõputöö detailid \ldots}

Lõputöö on kirjutatud [mis keeles] keeles ning sisaldab teksti [lehekülgede arv] leheküljel, [peatükkide arv] peatükki, [jooniste arv] joonist, [tabelite arv] textit.

\pagebreak

%---------------------ABBREVIATIONS AND GLOSSARY OF TERMS---------------------
\selectlanguage{english}
\section*{\begin{center}
Table of abbreviations and terms
\end{center}}

\begin{tabular}{p{3 cm} p{10cm}}
BTC & Bitcoin currency code\\
AML & \textit{Anti Money Laundering}, processes implemented by Financial Institutions to hinder money laundering and comply with regulation\\
CTF & \textit{Counter Terrorist Financing}, processes implemented by Financial Institutions to hinder terrorist financing and comply with regulation\\
KYC & \textit{Know Your Customer}, proccesses of Financial institution to identify and verify customers' identities to aid AML and CTF\\
ISSRM & \textit{Information Systems Security Risk Management} \\
SK & \textit{Sertifitseerimiskeskus} (Certification Center), SK ID Solutions AS, the only Certificate Authority (CA) in Estonia for the Estonian ID card system. \\
LDAP & \textit{Lightweight Directory Access Protocol} hosted by SK
\end{tabular}

\pagebreak

%----------------------------TABLE OF CONTENTS----------------------------------
\tableofcontents
\newpage

%----------------------LIST OF DRAWINGS-------------------------------
\listoffigures
\pagebreak

%----------------------LIST OF TABLES---------------------------------
\listoftables
\pagebreak

%-----------------------------CHAPTER 1 - INTRODUCTION-------------------------------
\section{Introduction} \label{sec:1}

Payments today are the laggard of the information age. While emails can be sent instantly for free anywhere in the world, money is either slow and/or expensive to move digitally. Bank transfers can take days, only work during business hours, and have high fees across borders. Card payments are instant, but subject merchants to high fees and chargeback risks. Paypal brought convenient payments to the web, but at a high cost to accept payments and move funds internationally. Fintech companies like Venmo and Square can create the illusion of fast payments, but still take days to settle in the background with the potential chargeback risks. This cost comes from the highly regulated centralised financial payments systems with little economic incentive to reduce fees. A usable digital currency would greatly alleviate this friction in transferring value that theoretically costs the economy an estimated 1\% of GDP annually \cite{kaarmann2013cost}.

Bitcoin was the first successful implementation of a decentralised digital currency. Nakamoto's peer to peer digital cash system completely sidestepped the existing financial system\cite{nakamoto2008bitcoin}. Its clever proof of work consensus protocol, economic incentives for nodes to maintain the network, pseudo anonymity, and irreversible transactions implemented on the public ledger Blockchain technology has been called ``the next technological revolution''\todo{citation, probably from Blockchain Revolution}. Hundreds of Altcoins followed Bitcoin's lead borrowing from the Blockchain technology to implement other flavours of cryptocurrency and digital asset management. Despite the rapid growth of the cryptocurrency ecosystem, everyday payments are a niche use case for digital currencies, which are more commonly used for investment and financial speculation\cite{Khairuddin:2016:EMB:2851581.2892500}. Merchants accepting Bitcoin payments are in fact immediately converting funds to a fiat currency for a non negligible fee. Bitcoin Exchanges are high cost gatekeepers between the cryptocurrency and financial systems.

What is missing today are incentives for parties on both sides of payments to hold assets end to end in digital currency. The cost and friction of moving between two financial systems, crypto and fiat, eliminates the perceived benefits of crypto currencies. The Euro 2.0 project aims to implement fiat currency on digital currency technology and reduce friction by eliminating unnecessary financial intermediaries. The unanimous adoption of Estonian ID card in Estonia and the Ethereum distributed application platform make a prototype system possible. This thesis introduces the Euro 2.0 system, its impact on stakeholders in the payments, and assesses the security, scalability, and privacy risks of the implementation to determine whether this system can in fact reasonably support a national digital currency.

\subsection{Existing Body of Knowledge} \label{ssec:1.1}
\todo[inline]{Existing body of knowledge to gap detection}


\subsection{Research Questions} \label{ssec:1.2}

This thesis explores the feasibility of the Euro 2.0 digital currency by answering the following research question:
\begin{quoting}
	\textbf{RQ: }\textit{How do we assure that the proposed Euro 2.0 digital currency does not have any major security, scalability, or privacy flaws compromising the usefulness of the monetary system?}
\end{quoting}

In which we explore in sub research questions:
\begin{quoting}
\textbf{RQ1: }\textit{How do we describe the relevant features needed for analysis of the Euro 2.0 digital currency?}
\end{quoting}
\begin{quoting}
\textbf{RQ2: }\textit{How does adoption of Euro 2.0 digital currency impact the relationship with money for key stakeholders: users, merchants, governments, and financial institutions?}
\end{quoting}
\begin{quoting}
\textbf{RQ3: }\textit{How do we assess the security and privacy risks of Euro 2.0 digital currency system and potential impact on stakeholders?}
\end{quoting}

Answering \textbf{RQ} will result in one of two possible outcomes:
\begin{itemize}
	\item The Euro 2.0 system is free from significant risks in functioning as a digital monetary system.
	\item The Euro 2.0 system has one or more serious risks that need to be adressed before significant adoption.
\end{itemize}
In order to do a risk analysis, the key features of the Euro 2.0 system need to be identified and implementation details described by answering \textbf{RQ1}. Following a clear specification of the system, \textbf{RQ2} explores the current and future relationship with money of key stakeholders after adoption of Euro 2.0. This exploration of the stakeholders' relationship with money grounds the analysis of the impact of realised risks uncovered in \textbf{RQ3}. The severity and likelihood of realised risks to the monetary system lead to an answer to the original research question \textbf{RQ}.

\subsection{Research Methods} \label{ssec:1.3}
The thesis utilises methods from design science and Information Systems Security Risk Management (ISSRM) to approach the research questions. The main contributions are:
\begin{itemize}
	\item Analysis of stakeholders behaviour transition to Euro 2.0 system
	\item Risk analysis of the current Euro 2.0 system
	\item Recommendations to mitigate most severe risks
	\item Validation of risks and vulnerabilities on existing codebase test network
\end{itemize}

\subsection{Structure of the Thesis} \label{ssec:1.4}

\hypernameref{sec:2} will give an overview of the existing body of knowledge needed to understand the remaining chapters including: traditional finance, Bitcoin, Tether, Ethereum, Estonia ID, and research methods.
\hypernameref{sec:3} will describe the motivation, features, and implementations of the Euro 2.0 system and prototype needed for analysis. \hypernameref{sec:4} will analyse the impact of Euro 2.0 on stakeholders using design science research methods to better understand the socio-technical impact of the system. \hypernameref{sec:5} will perform the full risk analysis of the Euro 2.0 implementation from the angles of Security, Scalability, and Privacy using the ISSRM model and security design patterns research methods. \hypernameref{sec:6} will evaluate the findings of the risk analysis on the actual running prototype to verify the findings. And finally \hypernameref{sec:7} the conclusion will answer the research question and suggest future avenues of research.

\pagebreak

%--------------------CHAPTER 2 - BRIDGE-----------------
\section{Chapter 2: Bridge of Knowledge} \label{sec:2}

\todo[inline]{Write Chapter 2}

\subsection{Traditional Finance System}

\subsection{CryptoCurrencies and Payments}
Existing crypto currencies not great for payments...

\subsubsection{Bitcoin}

\subsubsection{Tether}

\subsubsection{Anonymity vs. Regulation vs. Trust}

\subsection{Ethereum}
\begin{itemize}
	\item WTF is this thing?
	\item addresses
	\item messages
	\item events
\end{itemize}

\subsection{Solidity Smart Contracts}
\begin{itemize}
	\item what can they do?
	\item data
	\item functions
	\item modifiers
	\item throw exceptions
\end{itemize}

\subsection{Estonia ID Card}

\subsection{Future Adoption Research}
?

\subsection{OCTAVE Allegro}

\pagebreak

%--------------------CHAPTER 3-----------------
\section{Chapter 3} \label{sec:3}

\subsection{Introduction} \label{ssec:3.1}
This chapter introduces the Euro 2.0 digital currency system. The contents of this section are based from a prototype developed by the Euro 2.0 Foundation as a non profit initiative. All the original code is accessible in Github under the MIT License as indicated in \hyperref[ssec:a.1]{Appendix A.1}. The chapter answers the following research question:

\begin{quoting}
\textbf{RQ1:} \textit{How do we describe the relevant features needed for risk analysis of the Euro 2.0 digital currency?}
\end{quoting}

Which is broken down into the following sub-questions:
\begin{quoting}
	\textbf{RQ1.1: }\textit{What are the features of the Euro 2.0 digital currency?}
\end{quoting}{
\begin{quoting}
	\textbf{RQ1.2: }\textit{What are the decentralized components?}
\end{quoting}{
\begin{quoting}
	\textbf{RQ1.3: }\textit{What are the centralized components?}
\end{quoting}
\begin{quoting}
	\textbf{RQ1.4: }\textit{How do the decentralized and centralized work together to provide the features?}
\end{quoting}

Answering \textit{RQ1} lays the groundwork for further analysis in \hypernameref{sec:4} and \hypernameref{sec:5}. \hypersectionref{ssec:3.2} will briefly go through the motivation behind the Euro 2.0 digital currency system. \hypersectionref{ssec:3.3} will give an overview of the system architecture and features currently implemented answering \textit{RQ1.1}. \hypersectionref{ssec:3.4} will give an overview of the decentralized components built on the Ethereum platform answering \textit{RQ1.2}. \hypersectionref{ssec:3.5} will give an overview of centralized components built with traditional software development architecture answering \textit{RQ1.3}. Finally \hypersectionref{ssec:3.6} will briefly describe how the centralized and decentralized components work together to fulfill the features of \hypersectionref{ssec:3.2} answering \textit{RQ1.4}.

\subsection{Euro 2.0 Motivation} \label{ssec:3.2}

The idea of Euro 2.0 originated in 2014 from Kristo Käärmann's blogpost \textit{Government Backed Bitcoin}\cite{kaarmann2014government}. Following the success of Bitcoin, he saw an opportunity for a payments settled on a Government backed cryptocurrency, \textit{EuroCoin}, pegged one to one to real world Euro counterpart. Paypal cofounder Max Levchin supports the same idea, \textit{``I am confident that there will be a form of settlement that will be a crypto-currency''}\cite{pando2014levchin}. Bitcoin's short term fluctuations, functioning both as a commodity and a currency\todo{citation}, in value make it unreasonable for end to end holdings in a fiat based economy\todo{cite something about fluctuations}. Removing financial intermediaries in payments reduces the costs of transactions.

Even some governments have expressed interests in digital currency. The Swedish central bank debated whether to become the first to issue digital currency as a response to the country's move away from cash\cite{milne2016sweden}. The UK government pushed for a ``Call for Information'' on digital currencies in order to assess risks\cite{nermin2014ukcall} that was later responded by Citi bank's global Treasury and Trade Services (TTS) Technology and Innovation Team with a suggestion for government to create its own digital currency\cite{spaven2015ukcurrency}:

\begin{quoting}
	\textit{``The greatest benefits of digital currencies can be realised through the government issuing a digital form of legal tender. This currency would be less expensive, more efficient and provide greater transparency than current physical legal tender or electronic methods.''}
\end{quoting}

Following the rise in popularity of Ethereum, in mid 2016, another blogpost by Käärmann \textit{The future of money may be in the ether}\cite{kaarmann2016ether} described the rough idea of the system. I describe Euro 2.0 as solving the business problem:

\begin{quoting}
	\textit{How do I build a system to digitally store and transact fiat currency without a centralised for-profit financial intermediary conveniently, trustfully, and securely while satisfying government regulations?}
\end{quoting}

From this business problem derives the key pillars of Euro 2.0:

\begin{enumerate}
	\item Fiat Backed
	\item Decentralised Accounts and Transactions
	\item Identities of all Users
	\item Convenient Conversion of Fiat to and from Digital Euro
	\item Government can control monetary supply
	\item Features for Law Enforcement and AML
\end{enumerate}

\textit{Fiat Backed} (1) provides monetary stability to the system and builds trust with users and merchants to keep assets in the digital format. This eliminates the issue of constantly fluctuating daily value between real world and digital assets seen in crypto currencies today.

\textit{Decentralised Accounts and Transactions} (2) comes from the need of an impeccable record and process of transacting value that no centralised party can modify in a database. This is the key benefit and usecase of distributed ledger technology.

\textit{Identities of all Users} (3) builds trust in the system for users, merchants, and governments. If everyone is identified, any transaction can be legally ramified (assuming legislation arises supporting distributed ledger records in the court). The strong identity of Estonian ID card is a perfect fit for a digitally identifying mechanism and the main driver of the first prototype.

\textit{Convenient Conversion of Fiat to and from Digital Euro} (4) makes it easy for users to gradually start using the digital currency from existing financial infrastructure. At first this exchange gateway can be a private financial institution, similar to Tether\cite{tether2016whitepaper}, with a proof of reserve of the one to one Euro backing. Ideally this conversion service is hosted by the central bank itself to limit the number of financial intermediaries.

\textit{Government can control monetary supply} (5) follows from the ideal scenario of (4), the central bank can issue new money directly into the digital monetary system without a real world euro counterpart.

\textit{Features for Law Enforcement and AML} (6) is the most controversial aspect of the system. Bitcoin was made to sidestep the direct control of any third party, including government\cite{nakamoto2008bitcoin}. Euro 2.0 needs to be regulated from the start with full support of governments, which require means of necessary intervention that typically happen today via cooperation with traditional financial institutions\todo{cite relationship between banks and government}.

\subsection{Euro 2.0 Features} \label{ssec:3.3}

The following section describes the main features of the Euro 2.0 system. Features are enumerated with the label \textbf{XY\#} where:
\begin{itemize}
	\item \textbf{X} is an abbreviation of the domain of the feature, described in the \hypernameref{sssec:3.3:domains} section
	\item \textbf{Y} is client, admin, or server. Client is a user of the system, admin is some superuser with special permissions, and server is some centralized or decentralized server infrastructure
	\item \textbf{\#} is the number of a feature for a given \textbf{XY}
\end{itemize}

Features are implemented with a combination of decentralized and centralized components described in \hypersectionref{ssec:3.4} and \hypersectionref{ssec:3.5} respectively.

\subsubsection{Domains} \label{sssec:3.3:domains}

\hypertableref{tab:domains} gives an overview of the domains of Euro 2.0 used to group features described in later sections.

\begin{center}
\begin{tabular}{ | l | c | p{10cm} | }
 \hline
 Domain & Abbr. & Description \\
 \hline
 \textbf{Account} & A & mechanism of storage of value in the system
 \\ \hline
 \textbf{Identity} & I & features linking real life human identity to users
 \\ \hline
 \textbf{Transaction} & T & mechanism of transfer of value in the system
 \\ \hline
 \textbf{Reserve} & R & features regarding the exchange of value between traditional Euro (EUR) in the financial system and digital Euro (EUR2)
 \\ \hline
 \textbf{Enforcement} & E & features for government regulators and law enforcement to police the system for misuse and AML
 \\ \hline
 \textbf{Convenience} & C & features for improving user experience and expanding use cases
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Domains of Euro 2.0}
\label{tab:domains}

% TODO: I'm not sure if this table is actually relevant anymore
% \hypertableref{tab:centVsDecent} gives an overview of the distribution of centralised and decentralised domains of the Euro 2.0 system.
%
% \begin{center}
% \begin{tabular}{ |c|c| }
%  \hline
%  Centralised & Decentralised \\
%  \hline
%  Identity & Account \\
%  Reserve & Transaction \\
%  Enforcement & Network \\
%  Convenience & \\
%  \hline
% \end{tabular}
% \end{center}
% \captionof{table}{Centralised vs. Decentralised Domains of Euro 2.0}
% \label{tab:centVsDecent}

\subsubsection{Entities} \label{sssec:3.3:entities}

\hypertableref{tab:entities} clarifies key data entities used throughout the description of features.

\begin{center}
\begin{tabular}{ | p{3cm} | p{12cm} | }
 \hline
 Entity & Description
 \\ \hline\hline
 Address & Ethereum externally controlled address (i.e. public key) holding EUR2 and Ether
 \\ \hline
 Key & Ethereum address private key needed to make transactions (EUR2 or Ether) for an address
 \\ \hline
 Account & All verified Ethereum addresses for an ID
 \\ \hline
 Account Balance & Sum of total balance of EUR2 in an account
 \\ \hline
 ID & Estonian ID code of an individual (citizen, resident, e-resident)
 \\ \hline
 ID Name & Name of person associated with an Estonian ID Code
 \\ \hline
 EUR & Euro currency in an Estonian bank account
 \\ \hline
 EUR2 & Euro currency in the Euro 2.0 digital form, balance of an address in the Euro 2.0 Ethereum contract
 \\ \hline
 Wallet & Client program (app or mobile web) used as an interface to Euro 2.0 system, accessible keys to addresses
 \\ \hline
 Wallet Password & Password used to encrypt and decrypt local wallet
 \\ \hline
 Backup Password & Password used to encrypt and decrypt keys and address to send to backup server
 \\ \hline
 Designator account & Account collecting seized funds
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Euro 2.0 Entities}
\label{tab:entities}

\subsubsection{Roles} \label{sssec:3.3:roles}

\begin{center}
\begin{tabular}{ | p{3cm} | p{12cm} | }
 \hline
 Role & Description
 \\ \hline\hline
 CryptoFiat Master & Ethereum address (public / private key) to master contract
 \\ \hline
 Approver & Ethereum address (public / private key) entitled to approver operations
 \\ \hline
 Reserve Bank & Ethereum address (public / private key) entitled to reserve operations and funds
 \\ \hline
 Enforcer & Ethereum address (public / private key) entitled to to enforcer operations
 \\ \hline
 Designator & Ethereum address (public / private key) entitled to designator operations
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Euro 2.0 Roles}
\label{tab:roles}

\subsubsection{Processes} \label{sssec:3.3:processes}

\hypertableref{tab:processes} clarifies different processes used throughout the description of features.

\begin{center}
\begin{tabular}{ | p{3cm} | p{12cm} | }
 \hline
 Process & Description
 \\ \hline\hline
 Approval & Link Ethereum address with the an Estonian ID number via ID card certificate verification. Allow Ethereum address to send EUR2.
 \\ \hline
 Freeze & Stop address from sending EUR2.
 \\ \hline
 Close & Stop address from receiving EUR2.
 \\ \hline
 Seize & Remove EUR2 from an address and send them to the designator account.
 \\ \hline
 Name checks & AML PEP and Sanction list check on real name of person.
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Euro 2.0 Processes}
\label{tab:processes}

\subsubsection{Account Features} \label{sssec:3.3:accounts}

Client
\begin{itemize}
	\item \textbf{AC1} - Create address
	\item \textbf{AC2} - View account balance
\end{itemize}

Server
\begin{itemize}
	\item \textbf{AS1} - Aggregate account balance
\end{itemize}

The account features allow users of store balance of EUR2. The requirement is an Ethereum public and private key pair created in \textbf{AC1}. Viewing account balance is taking the sum of all addresses under ownership of the user's private keys. A server aggregation is needed for retrieving the balances and resolving delegated balances described later.

\subsubsection{Identity Features} \label{sssec:3.3:identity}

Client
\begin{itemize}
	\item \textbf{IC1} - Approve address
\end{itemize}

Server
\begin{itemize}
	\item \textbf{IS1} - Check external source for valid ID
	\item \textbf{IS2} - Approve address
	\item \textbf{IS3} - Save ID number to address mapping
	\item \textbf{IS4} - Look up ethereum address by ID
\end{itemize}

In order for an address to transact EUR2, it needs to be approved, that is linked with an identity. The server here plays a critical role in approving the address by checking a client approval request (\textbf{IC1}) with an external source (\textbf{IS1}) then both approving this address on the blockchain (\textbf{IS2}) and saving this mapping (\textbf{IS3}) for use in other components (\textbf{IS4}).

\subsubsection{Transaction Features} \label{sssec:3.3:transactions}

Client
\begin{itemize}
	\item \textbf{TC1} - Send EUR2 to an address
	\item \textbf{TC2} - Send EUR2 to an ID
	\item \textbf{TC3} - Receive EUR2 to an address
	\item \textbf{TC4} - Receive EUR2 to an ID
	\item \textbf{TC5} - Send EUR2 to a EUR bank account
\end{itemize}

Server
\begin{itemize}
	\item \textbf{TS1} - Resolve ID to an address
	\item \textbf{TS2} - Escrow EUR2 to an ID
	\item \textbf{TS3} - Release escrow EUR2 to an address for an ID
	\item \textbf{TS4} - Execute valid EUR transaction
	\item \textbf{TS5} - Execute valid EUR2 transaction
\end{itemize}

The transaction features are the heart of the EUR2 system. What differentiate Euro 2.0 from other cryptocurrencies is the ability to easily send funds amongst digital (EUR2) and real (EUR) euros. \textbf{TC1} and \textbf{TC3} allow a user to transact EUR2 directly with the Ethereum decentralised system using ethereum addresses. \textbf{TC2} and \textbf{TC4} allow a user to conveniently send EUR2 to a human being via their ID code using the centralised identity infrastructure (\textbf{IS4}). Funds sent to an ID that does not yet have an Ethereum address will have EUR2 held to a new ethereum address in Escrow (\textbf{TS2}) and then later released and transferred to an address created and approved by the receiver (\textbf{TS3}). \textbf{TS5} provides the infrastructure to execute EUR2 transactions for \textbf{TC1} through \textbf{TC4}. A centralised party needs to provide the mediation gateway (\textbf{TS4}) allowing a user to send EUR2 to a EUR bank account (\textbf{TC5}).

\subsubsection{Reserve Features} \label{sssec:3.3:reserve}

Client
\begin{itemize}
	\item \textbf{RC1} - Convert EUR to EUR2
	\item \textbf{RC2} - Convert EUR2 to EUR
	\item \textbf{RC3} - Proof of reserve
\end{itemize}

Admin
\begin{itemize}
	\item \textbf{RA1} - Assign reserve bank address
	\item \textbf{RA2} - Manage reserve bank account
\end{itemize}

Server
\begin{itemize}
	\item \textbf{RS1} - Resolve address from ID of received EUR transaction
	\item \textbf{RS2} - Create EUR2
	\item \textbf{RS3} - Destroy EUR2
\end{itemize}

The reserve features allow convenient conversion between EUR and EUR2. The reserve process for converting from EUR to EUR2 is to to receive a EUR bank transaction with an individuals ID (\textbf{RS1}), create EUR2 (\textbf{RS2}) of the equivalent amount, resolve the ID to an ethereum address (\textbf{TS1}), and send this to the address for the ID (\textbf{TS5}).  Likewise the process from converting EUR2 to EUR is receiving a EUR2 transaction (\textbf{RC1}), destroy the EUR2 (\textbf{RS3}), and send a bank transfer of the equivalent amount in EUR (\textbf{TS4}). Finally there is admin feature to assign the reserve EUR2 address to make conversions (\textbf{RA1}) and actually perform manage the banking operations on the bank account (\textbf{RA2}).

\subsubsection{Enforcement Features} \label{sssec:3.3:enforcement}

Admin
\begin{itemize}
	\item \textbf{EA1} - Freeze account
	\item \textbf{EA2} - Seize account funds to designator's address, closing the account
	\item \textbf{EA3} - Assign enforcement
	\item \textbf{EA4} - Assign designator
	\item \textbf{EA5} - Set designator address
	\item \textbf{EA6} - View name check and analysis data
\end{itemize}

Server
\begin{itemize}
	\item \textbf{ES1} - Name checks on ID names
	\item \textbf{ES2} - Create database of transactions with ID
\end{itemize}

The enforcement features allow law enforcement to do their job that would be traditionally be done via financial institutions. Law enforcement can freeze (\textbf{EA1}) and seize (\textbf{EA2}) funds to the designator address (\textbf{EA5}). Admin controls exist to assign the role of enforcer (\textbf{EA3}) and designator (\textbf{EA4}). Finally automatic processes in the server need to perform name checks on all users of the system (\textbf{ES1}) and create a database of identities and transactions (\textbf{ES2}) to be usable by some analysts (\textbf{EA6}).

\subsubsection{Convenience Features} \label{sssec:3.3:backup}

The convenience features are not necessarily central to a functioning and compliant fiat and digital monetary system, but are quite useful to increase the usefulness and usability barrier. They are quite important to consider in a security analysis, hence listed here.

\paragraph{Wallet Security}
Client
\begin{itemize}
	\item \textbf{CC1} - Encrypt wallet
	\item \textbf{CC2} - Decrypt wallet
\end{itemize}

Since private keys are stored locally on a user's device, they should be encrypted (\textbf{CC1}) with some password when not in use and decrypted (\textbf{CC2}) when needed for signing transactions.

\paragraph{Key Backup}

Client
\begin{itemize}
	\item \textbf{CC3} - Encrypt keys for addresses
	\item \textbf{CC4} - Create a challenge question
	\item \textbf{CC5} - Send addresses, keys, and challenge to backup server for an ID
	\item \textbf{CC6} - Retrieve addresses and keys from backup server for an ID with challenge answer
	\item \textbf{CC7} - Decrypt keys for addresses
\end{itemize}

Server
\begin{itemize}
	\item \textbf{CS1} - Save encrypted addresses and keys for an ID
	\item \textbf{CS2} - Check challenge answer
	\item \textbf{CS3} - Load encrypted addresses and keys for an ID
\end{itemize}

Since keys are stored locally, if not backed up, they can be easily lost with the device. Euro2.0 provides a centralised convenience feature to back up these keys for an ID and secured by a challenge question. The user can encrypt their keys with a password (\textbf{CC3}), create a challenge question (\textbf{CC4}), send the addresses, encrypted keys, and challenge to the server (\textbf{CC5}) to be saved (\textbf{CS1}). The user can then retrieve the addresses and encrypted keys for an ID from the server (\textbf{CC6}) by providing the correct challenge answer checked by the server (\textbf{CS2}) (\textbf{CS3}), and finally the keys can be decrypted by the user (\textbf{CC7}).

\paragraph{Transfer Info}

Client
\begin{itemize}
	\item \textbf{CC8} - Encrypt copies of transfer details for sender and receiver
	\item \textbf{CC9} - Save transfer details for a transaction hash
	\item \textbf{CC10} - Load transfer details for a transaction hash
	\item \textbf{CC11} - Decrypt transfer details for sender or recipient
\end{itemize}

Server
\begin{itemize}
	\item \textbf{CS4} - Save transfer details for a transaction hash
	\item \textbf{CS5} - Load transfer details for a transaction hash
\end{itemize}

Transfer info features provide extra information to transfers only visible to sender and receiver. First a sender of a transaction encrypts two copies of the transfer details, one with the sender's public key and the other with the recipient's private key (\textbf{CC8}). Then these can be saved to the transfer info server with the transaction's hash (\textbf{CC9} and \textbf{CS4}). Then these details can be loaded from the server (\textbf{CS5}) by the sender or receiver from the server (\textbf{CC10}) and decrypted with their respective private key (\textbf{CC11}).

\paragraph{Account Recovery}

Client
\begin{itemize}
	\item \textbf{CC12} - Set address recovery address
	\item \textbf{CC13} - Recover address funds
\end{itemize}

Server
\begin{itemize}
	\item \textbf{CS6} - Execute address funds recovery transaction and close account
\end{itemize}

Account recovery features offer some protection from accidentally losing keys to an address. A user can set a very trusted address, a friend or close relative, with the able to recover funds (\textbf{CC12}). This trusted party at any time can perform the funds recovery and withdraw all of the account's funds to their account with their key (\textbf{CC13}) executed by the server (\textbf{CS6}).

\paragraph{Delegated Transfers - Send without Ether}

Client
\begin{itemize}
	\item \textbf{CC13} - Execute EUR2 transaction with EUR2 fee without gas
\end{itemize}

\begin{itemize}
	\item \textbf{CS7} - Fulfill delegated EUR2 transaction and claim EUR2 fee
\end{itemize}

Finally, this convenience feature eliminates the side effect of using Ethereum, consuming gas (ether) in transactions. A trusted third party, the wallet server in this case, can execute transactions on behalf of the sender (\textbf{CC13}) and take the fee in EUR2 cents instead of ether (\textbf{CS7}). This requires only the trusted third party to have Ether and the user can only worry about EUR2.

\subsection{Decentralized Components} \label{ssec:3.4}

This section walks through the decentralized components of the Euro 2.0 system on the Ethereum distributed applications platform. The main container of code deployment is the \textit{Contract}. Once deployed, the contract is on the Blockchain forever processing messages (transactions) sent to it unless an optional destroy function is implemented and called. All function calls and data modifications are irreversible and publicly visible while being executed on the 1000s of computers on the Ethereum network maintaining the Ethereum Blockchain. Thus we describe the implementation of the contracts in detail, since there is an of the code, once deployed, and is important in the security analysis considerations.

The decentralized contracts are comprised of of the main administrator contract (\textit{CryptoFiat}), shared contracts (\textit{Constants}, \textit{Relay}, \textit{Data}, \textit{InternalData}), and the upgradable subcontracts providing functionality to the system (\textit{Accounts}, \textit{Approving}, \textit{Reserve}, \textit{Enforcement}, \textit{AccountRecovery}, \textit{Delegation}). These decentralized contracts function as gateways to the shared decentralized data of the Euro 2.0 system used together with centralized components and client explained in \hypersectionref{ssec:3.5} to fulfill the features, described in \hypersectionref{ssec:3.6}.

\todo[inline]{Diagram with inheritance structure of all contracts}

\subsubsection{CryptoFiat Contract} \label{sssec:3.4:cryptofiat}

The heart of decentralized Euro 2.0 is the \textit{CryptoFiat} contract. This contract functions as an administrator, managing the master address and the references to all deployed contracts comprising the main functionality of the Euro 2.0 system.

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{9cm} | }
 \hline
 Name & Type & Description
 \\ \hline\hline
 \code{masterAccount} & \code{address} & Master ethereum account whose allowed to do operations on the CryptoFiat contract. Set in the constructor and changeable by master account owner.
 \\ \hline
 \code{contractAddress} & \code{uint256 => address} & Stores mapping from subcontract id to deployed address of active subcontract.
 \\ \hline
 \code{contractId} & \code{address => uint256} & Stores mapping from active subcontract address to id.
 \\ \hline
 \code{contracts} & \code{address[]} & Array with the address of all contracts ever added to the Euro 2.0 system. It's contents is never cleared.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{CryptoFiat contract data}
\label{tab:cryptoFiatData}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{9cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{contractActive} & \code{address addr} & Returns \code{bool} whether the subcontract at address \code{addr} is active.
 \\ \hline
 \code{contractsLength} & & Returns the length of \code{contracts}, i.e. the number of all contracts ever deployed.
 \\ \hline
 \code{appointMasterAccount} & \code{address next} & Sets \code{masterAccount} to \code{next} and hence gives up control of the CryptoFiat contract. Can only be called by master account owner.
 \\ \hline
 \code{upgrade} & \specialcell{\code{uint256 id},\\ \code{address next}} & Upgrades the active contract with \code{id} to the address \code{next}. Only owner of master account can call this. \code{prev} cannot be the same contract as \code{next}. \code{next} cannot be an already active contract. \code{contractAddress}, \code{contractId}, and \code{contracts} are updated appropriately.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{CryptoFiat contract functions}
\label{tab:cryptoFiatFunctions}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{9cm} | }
 \hline
 Event & Args & Description
 \\ \hline\hline
 \code{ContractUpgraded}
 & \specialcell{\code{uint256 indexed id} \\ \code{address previous} \\ \code{address next}}
 & Event describing upgrading the contract of index \code{id} from \code{previous} to \code{next}
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{CryptoFiat contract events}
\label{tab:cryptoFiatEvents}

\subsubsection{Shared Contracts: Constants, Relay, Data, InternalData} \label{sssec:3.4:shared}

The code in the shared contracts in Euro 2.0 are exposed ultimately in the \textit{InternalData} contract interface that heavily calls \textit{Data contract}. \textit{InternalData} contract acts as an abstract Contract inherited by all the sub contracts providing functionality. Only the \textit{Data} contract is actually constructed and deployed on the Blockchain, the other shared contracts are simply organising code. \textit{InternalData} inherits from \textit{Constants} and \textit{Relay}. While \textit{Relay} inherits from \textit{Constants} and references \textit{Data} for use by \textit{InternalData}. \textit{Data} inherits from \textit{Relay}.

\paragraph{Constants Contract}

The \textit{Constants} contract has no functionality, but holds convenient values accessible to all subcontracts. The contract ids in \hypertableref{tab:constantSubcontractIds} are used in contract deployment mapping to access particular subcontracts. Bucket identifiers in \hypertableref{tab:constantBucketIds} are used in data storage key computation to distinguish types of data. Account states listed in \hypertableref{tab:constantAccountStates} are boolean flags used as permissions for flow of transactions. Finally events listed in \hypertableref{tab:constantEvents} are a convenient record of when some action occurred in the system.

\begin{center}
\begin{tabular}{ | l | l | p{10cm} | }
 \hline
 Contract Name & Id & Description
 \\ \hline\hline
 DATA & 1 & Contains data storage for all Euro 2.0 contracts
 \\ \hline
 ACCOUNTS & 2 & Contract regarding account operations
 \\ \hline
 APPROVING & 3 & Contract approving accounts based on verified ID
 \\ \hline
 RESERVE & 4 & Contract able to increase, decrease, and transfer supply
 \\ \hline
 ENFORCEMENT & 5 & Contract with law enforcement operations
 \\ \hline
 ACCOUNT\_RECOVERY & 6 & Contract assigning account recovery options
 \\ \hline
 DELEGATION & 7 & ???
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Constant contract subcontract ids}
\label{tab:constantSubcontractIds}

\begin{center}
\begin{tabular}{ | l | l | p{10cm} | }
 \hline
 Contract Name & Id & Description
 \\ \hline\hline
 STATUS & 1 & Account states
 \\ \hline
 BALANCE & 2 & Account balance
 \\ \hline
 DELEGATED\_TRANSFER\_NONCE & 3 & ???
 \\ \hline
 RECOVERY\_ACCOUNT & 4 & Recovery account assignments
 \\ \hline
 TOTAL\_SUPPLY & 5 & Total supply issued by reserve
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Constant contract bucket identifiers}
\label{tab:constantBucketIds}

\begin{center}
\begin{tabular}{ | l | l | p{10cm} | }
 \hline
 State & Id & Description
 \\ \hline\hline
 APPROVED & 1 & Account has a linked ID approved and can send funds.
 \\ \hline
 CLOSED & 2 & Account is closed (by owner or law enforcement) and cannot receive funds.
 \\ \hline
 FROZEN & 4 & Account is frozen by law enforcement and cannot send funds.
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Constant contract account state}
\label{tab:constantAccountStates}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{9cm} | }
 \hline
 Event & Args & Description
 \\ \hline\hline
 \code{Transfer}
 & \specialcell{\code{address indexed source} \\ \code{address indexed destination} \\ \code{uint256 amount}}
 & Event when \code{amount} was transferred from \code{source} to \code{value}.
 \\ \hline
 \code{AccountApproved}
 & \code{address indexed source}
 & Event signifying address \code{source} was approved.
 \\ \hline
 \\ \hline
 \code{AccountClosed}
 & \code{address indexed source}
 & Event signifying address \code{source} was closed.
 \\ \hline
 \code{AccountFreeze}
 & \specialcell{\code{address indexed source}, \code{bool frozen}}
 & Event signifying address \code{source} was frozen.
 \\ \hline
 \code{SupplyChanged}
 & \code{uint256 totalSupply}
 & Event signifying total supply changed to \code{totalSupply}.
 \\ \hline
\end{tabular}
}
\end{center}
\captionof{table}{Constant contract events}
\label{tab:constantEvents}

\paragraph{Relay Contract}

The \textit{Relay} contract holds convenience methods for subcontracts to access each other. The functions in \hypertableref{tab:relayFunctions} use the reference to \textit{CryptoFiat} in \hypertableref{tab:relayData} to provide a reference to all deployed subcontracts. There is also convenient restriction modifiers listed in \hypertableref{tab:relayModifiers}.

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{9cm} | }
 \hline
 Name & Type & Description
 \\ \hline\hline
 \code{cryptoFiat} & \code{address} & Reference to main \textit{CryptoFiat} contract deployment used to resolve address to all other contracts
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Relay contract data}
\label{tab:relayData}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{9cm} | }
 \hline
 Modifier &  Description
 \\ \hline\hline
 \code{onlyMasterAccount} & Restricts function to only be usable by master account by checking \code{msg.sender}.
 \\ \hline
 \code{onlyContracts} & Restricts function to only be usable by active contracts.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Relay contract modifiers}
\label{tab:relayModifiers}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{9cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{switchCryptoFiat} & \code{address next} & Sets the address of \textit{CryptoFiat} contract. Restricted to \code{onlyMasterAccount}.
 \\ \hline
 \code{contractAddress} & \code{uint256 id} & Returns the address of subcontract of \code{id} listed in \hypertableref{tab:constantSubcontractIds}.
 \\ \hline
 \code{accounts} & & Returns reference to \code{ACCOUNTS} contract.
 \\ \hline
 \code{data} & & Returns reference to \code{DATA} contract.
 \\ \hline
 \code{approving} & & Returns reference to \code{APPROVING} contract.
 \\ \hline
 \code{reserve} & & Returns reference to \code{RESERVE} contract.
 \\ \hline
 \code{accountRecovery} & & Returns reference to \code{ACCOUNT\_RECOVERY} contract.
 \\ \hline
 \code{delegation} & & Returns reference to \code{DELEGATION} contract.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Relay contract functions}
\label{tab:relayFunctions}

\paragraph{Data Contract}

The \textit{Data} contract provides the main data access layer for all subcontracts which is accessed by convenience methods in the \textit{InternalData} contract. No subcontracts work with this contract directly. The main data object is defined in \hypertableref{tab:dataData} and functions on this data in \hypertableref{tab:dataFunctions}.

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{9cm} | }
 \hline
 Name & Type & Description
 \\ \hline\hline
 \code{\_data} & \code{bytes32 => bytes32} & The shared data storage structure for all subcontracts
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Data contract data}
\label{tab:dataData}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{set} & \specialcell{\code{uint256 bucket}\\ \code{bytes32 key}\\ \code{bytes32 value}} & Saves the data \code{value} with the hash key \code{sha3(bucket, key)}, with \code{bucket} referring to the bucket id list in \hypertableref{tab:constantBucketIds} and key being an arbitrary value. Restricted to \code{onlyContracts} callers.
 \\ \hline
 \code{get} & \code{uint256 id} & Returns \code{byte32} value stored in hash key \code{sha3(bucket, key)}, with bucket id being from the list in \hypertableref{tab:constantBucketIds}.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Data contract functions}
\label{tab:dataFunctions}

\paragraph{InternalData Contract}

\textit{InternalData} is the main contract for accessing data storage used by all subcontracts. All functions here are marked \code{internal}, meaning they can only be accessed from within a contract. All subcontracts extend \textit{InternalData}. Data access functions are listed in \hypertableref{tab:internalDataAccessFunctions}, account status functions are listed in \hypertableref{tab:internalDataAccountStatusFunctions}, modifiers in \hypertableref{tab:internalDataModifiers}, and account functions in \hypertableref{tab:internalDataAccountFunctions}.

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{\_balanceOf} & \code{address addr} & Returns \code{uint256} BALANCE stored for address \code{addr}.
 \\ \hline
 \code{\_setBalanceOf} & \specialcell{\code{address addr},\\ \code{uint256 value}} & Stores BALANCE of \code{value} for \code{addr}.
 \\ \hline
 \code{\_statusOf} & \code{address addr} & Returns \code{uint256} account STATUS of address \code{addr} as listed in status codes of \hypertableref{tab:constantAccountStates}.
 \\ \hline
 \code{\_setStatusOf} & \specialcell{\code{address addr},\\ \code{uint256 value}} & Stores account STATUS of \code{value} for \code{addr}.
 \\ \hline
 \code{\_delegatedTransferNonceOf} & \code{address addr} & Returns \code{uint256} of last nonce used in delegatedTransfer for address \code{addr}.
 \\ \hline
 \code{\_setDelegatedTransferNonceOf} & \specialcell{\code{address addr},\\ \code{uint256 value}} & Stores last nonce used \code{value} in delegatedTransfer for address \code{addr}.
 \\ \hline
 \code{\_recoveryAccountOf} & \code{address addr} & Returns the \code{address} recovery account set for address \code{addr}.
 \\ \hline
 \code{\_setRecoveryAccountOf} & \specialcell{\code{address addr},\\ \code{address value}} & Stores recovery account \code{value} for address \code{addr}.
 \\ \hline
 \code{\_totalSupply} & & Returns total supply \code{uint256} of tokens in circulation.
 \\ \hline
 \code{\_setTotalSupply} & \code{uint256 value} & Stores \code{value} of total tokens in circulation.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{InternalData contract account status functions}
\label{tab:internalDataAccessFunctions}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{\_isApproved} & \code{address account} & Returns \code{bool} whether \code{account} is APPROVED.
 \\ \hline
 \code{\_isClosed} & \code{address account} & Returns \code{bool} whether \code{account} is CLOSED.
 \\ \hline
 \code{\_isFrozen} & \code{address account} & Returns \code{bool} whether \code{account} is FROZEN.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{InternalData account status functions}
\label{tab:internalDataAccountStatusFunctions}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{canSend} & \code{address account} & Validates if \code{account} can send by throwing an exception if it is not approved, frozen, or the address 0.
 \\ \hline
 \code{assertSend} & \code{address account} & Function form of \code{canSend}.
 \\ \hline
 \code{canReceive} & \code{address account} & Validates if \code{account} can receive by throwing an exception if it is closed or the address 0.
 \\ \hline
 \code{assertReceive} & \code{address account} & Function form of \code{canReceive}.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{InternalData modifiers}
\label{tab:internalDataModifiers}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{\_withdraw} & \specialcell{\code{address account},\\ \code{uint256 amount}} & Withdraws \code{amount} from balance of \code{account}. Throws exception if \code{amount} is more than balance.
 \\ \hline
 \code{\_deposit} & \specialcell{\code{address account},\\ \code{uint256 amount}} & Deposits \code{amount} into balance for \code{account}. Throws exception if amount to withdraw plus balance is less than balance (overflow).
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{InternalData account functions}
\label{tab:internalDataAccountFunctions}

\subsubsection{Accounts Contract} \label{sssec:3.5:accounts}
The \textit{Accounts} contract exposes all the functions, listed in \hypertableref{tab:accountsFunctions}, necessary from \textit{InternalData} to work with accounts and balances.

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{balanceOf} & \code{address account} & Returns \code{uint256} balance of \code{account}.
 \\ \hline
 \code{statusOf} & \code{address account} & Returns \code{uint256} of boolean flags with the status of \code{account} as defined in table \hypertableref{tab:constantAccountStates}.
 \\ \hline
 \code{isApproved} & \code{address account} & Returns \code{bool} whether \code{account} is approved (can send funds).
 \\ \hline
 \code{isClosed} & \code{address account} & Returns \code{bool} whether \code{account} is closed (can not receive funds).
 \\ \hline
 \code{isFrozen} & \code{address account} &  Returns \code{bool} whether \code{account} is frozen (can not send funds).
 \\ \hline
 \code{transfer} & \specialcell{\code{address destination},\\ \code{uint256 amount}} & Withdraws \code{amount} from caller \code{msg.sender} and deposits \code{amount} into \code{destination}. Restricted to \code{msg.sender} that \code{canSend} and \code{destination} that \code{canReceive}. Logs \code{Transfer} event for \code{source}, \code{destination}, and \code{amount}.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Accounts functions}
\label{tab:accountsFunctions}

\subsubsection{Approving Contract} \label{sssec:3.5:approving}
\textit{Approving} contract exposes the functions necessary for approving accounts to transact in Euro 2.0. Only the \code{accountApprover}, \hypertableref{tab:approvingData}, can approve accounts. Modifiers, \hypertableref{tab:approvingModifiers} restrict access to functions, \hypertableref{tab:approvingFunctions}, to \code{accountApprover}.

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{9cm} | }
 \hline
 Name & Type & Description
 \\ \hline\hline
 \code{accountApprover} & \code{address} & Account approver address.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Approving contract data}
\label{tab:approvingData}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{onlyAccountApprover} & & Validates if \code{msg.sender} is \code{accountApprover} otherwise throws an exception.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Approving contract modifiers}
\label{tab:approvingModifiers}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{appointAccountApprover} & \code{address next} & Assigns address of \code{accountApprover} to \code{next}, removing approving privileges to the old address. Restricted to \code{onlyAccountApprover}.
 \\ \hline
 \code{approveAccount} & \code{address account} & Sets status of \code{account} to APPROVED to be able to send money. Restricted to \code{onlyAccountApprover}. Logs \code{AccountApproved} event for the approved \code{account}.
 \\ \hline
 \code{approveAccounts} & \code{address[] accounts} & Sets status of each account in \code{accounts} to APPROVED to be able to send money. Restricted to \code{onlyAccountApprover}. Logs \code{AccountApproved} event for the approved \code{account}.
 \\ \hline
 \code{closeAccount} & \code{address account} & Sets status of \code{account} to CLOSED to prevent the account from receiving money. Restricted to \code{onlyAccountApprover}. Logs \code{AccountClosed} event for the closed \code{account}.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Approving contract functions}
\label{tab:approvingFunctions}

\subsubsection{Reserve Contract} \label{sssec:3.5:reserve}

The \textit{Reserve} contract exposes the functions to increase and decrease supply of EUR2 in the Euro 2.0. Only the \code{reserveBank} account, \hypertableref{tab:reserveData}, can perform these tasks. The modifier in \hypertableref{tab:reserveModifiers} restrict access to functions listed in \hypertableref{tab:reserveFunctions} to \code{reserveBank}.

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{9cm} | }
 \hline
 Name & Type & Description
 \\ \hline\hline
 \code{reserveBank} & \code{address} & Reserve bank address.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Reserve contract data}
\label{tab:reserveData}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{onlyReserveBank} & & Validates if \code{msg.sender} is \code{reserveBank} otherwise throws an exception.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Reserve contract modifiers}
\label{tab:reserveModifiers}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{appointReserveBank} & \code{address next} & Assigns address of \code{reserveBank} to \code{next}, removing  privileges of the old address. Restricted to \code{onlyReserveBank}.
 \\ \hline
 \code{totalSupply} & & Returns \code{uint256} total supply of Euro 2.0 system. No restrictions on calling this method.
 \\ \hline
 \code{increaseSupply} & \code{uint256 amount} & Increases supply by \code{amount} and deposits \code{amount} of newly created EUR2 to the \code{reserveBank}. Restricted to \code{onlyReserveBank} and \code{reserveBank} \code{canReceive}. Throws exception if supply plus amount overflows.
 \\ \hline
 \code{decreaseSupply} & \code{uint256 amount} & Decreases supply by \code{amount} and withdraws \code{amount} from \code{reserveBank}, destroying the EUR2. Restricted to \code{onlyReserveBank} and \code{reserveBank} \code{canSend}. Throws exception if supply is less than amount. Logs \code{SupplyChanged} for the new supply \code{amount}.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Reserve contract functions}
\label{tab:reserveFunctions}

\subsubsection{Enforcement Contract} \label{sssec:3.5:enforcement}

The \textit{Enforcement} contract exposes the functions for law enforcement to freeze and seize funds. The two roles are the law enforcer, who can do the actions to freeze and seize funds, and account designator, who can control the account where the funds can be seized, described in \hypertableref{tab:enforcementData}. Modifiers in \hypertableref{tab:enforcementModifiers} restrict access to functions based on roll. The functions are listed in \hypertableref{tab:enforcementFunctions}.

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{9cm} | }
 \hline
 Name & Type & Description
 \\ \hline\hline
 \code{lawEnforcer} & \code{address} & Law enforcer address.
 \\ \hline
 \code{accountDesignator} & \code{address} & Account designator address.
 \\ \hline
 \code{account} & \code{address} & Law enforcement account.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Enforcement contract data}
\label{tab:enforcementData}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{onlyLawEnforcer} & & Validates if \code{msg.sender} is \code{lawEnforcer} otherwise throws an exception.
 \\ \hline
 \code{onlyAccountDesignator} & & Validates if \code{msg.sender} is \code{accountDesignator} otherwise throws an exception.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Enforcement contract modifiers}
\label{tab:enforcementModifiers}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{appointLawEnforcer} & \code{address next} & Assigns address of \code{lawEnforcer} to \code{next}, removing privileges of the old address. Restricted to \code{onlyLawEnforcer}.
 \\ \hline
 \code{appointAccountDesignator} & \code{address next} & Assigns address of \code{accountDesignator} to \code{next}, removing privileges of the old address. Restricted to \code{onlyAccountDesignator}.
 \\ \hline
 \code{withdraw} & \specialcell{\code{address from}, \\ \code{uint256 amount}} & Withdraws \code{amount} from account \code{from} and deposits \code{amount} into law enforcement \code{account}. Restricted to \code{onlyLawEnforcer} and \code{account} \code{canReceive}. Logs \code{Transfer} event with \code{from}, designator \code{account}, and \code{amount}.
 \\ \hline
 \code{freezeAccount} & \code{address target} & Sets status of \code{target} account to FROZEN so it can no longer send funds. Restricted to \code{onlyLawEnforcer}. Logs \code{AccountFreeze} event with \code{target} and value {true}.
 \\ \hline
 \code{unFreezeAccount} & \code{address target} & Removes FROZEN status of \code{target} account so it can send funds again. Restricted to \code{onlyLawEnforcer}. Logs \code{AccountFreeze} event with \code{target} and value \code{false}.
 \\ \hline
 \code{designateAccount} & \code{address account} & Sets law enforcement \code{account} to given \code{account}. Restricted to \code{onlyAccountDesignator} and \code{account} \code{canReceive}.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Enforcement contract functions}
\label{tab:enforcementFunctions}

\subsubsection{AccountRecovery Contract} \label{sssec:3.5:accountRecovery}

The \textit{AccountRecovery} exposes functionality intended for an account recovery mechanism. An account owner can designate a trusted party to withdraw all funds and close the account. The two functions enabling this functionality are listed in \hypertableref{tab:accountRecoveryFunctions}.

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{designateRecoveryAccount} & \code{address recoveryAccount} & Sets the recovery account for \code{msg.sender} to address \code{recoveryAccount}, replacing an existing \code{recoveryAccount}. To remove a recovery account the address 0 can be set.
 \\ \hline
 \code{recoverBalance} & \specialcell{\code{address from}, \\ \code{address into}} & Withdraws all funds from account \code{from} and deposits all funds to account \code{into} and then closing account \code{from} by setting its status to CLOSED. Restricted to account \code{from} \code{canSend} and account \code{into} \code{canReceive}. Logs \code{AccountClosed} event of \code{from} account and \code{Transfer} event of \code{from} account, \code{into} account, and \code{amount}.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{AccountRecovery contract functions}
\label{tab:accountRecoveryFunctions}

\subsubsection{Delegation Contract} \label{sssec:3.5:delegation}

\todo[inline]{The \textit{Delegation} contract is magic...}
Its functions are listed in \hypertableref{tab:delegationFunctions}}.

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{12cm} | }
 \hline
 Function & Args & Description
 \\ \hline\hline
 \code{nonceOf} & \code{address account} & Sets delegated transfer nonce of \code{account}.
 \\ \hline
 \code{transfer}
    & \specialcell{
 		% transfer request
        \code{uint256 nonce}, \\
		\code{address destination}, \\
		\code{uint256 amount}, \\
		\code{uint256 fee}, \\
        % transfer request signed by source
        \code{bytes signature}, \\
        % whom to pay for fulfilling transfer
        \code{address delegate}
 	   }
    & Makes a delegate transfer from a \code{source} account, recovered by extracting public key from elliptic curve \code{signature}, to \code{destination} of \code{amount} with fee \code{fee} paid to \code{delegate}. \code{nonce} is used to prevent replay attacks. Logs \code{Transfer} event for \code{source} account (in signature), \code{destination}, and \code{amount} and if there is a fee, also logs \code{Transfer} event for \code{source}, \code{delegate}, and the \code{fee}.
 \\ \hline
 \code{multitransfer}
 	& \specialcell{\code{uint256 count}, \\ \code{bytes transfers}, \\ \code{address delegate}}
	& Performs the same logic as \code{transfer} for \code{count} number of transfers encoded in \code{transfers} byte array.
 \\ \hline
\end{tabular}}
\end{center}
\captionof{table}{Delegation contract functions}
\label{tab:delegationFunctions}

\subsection{Centralized Components} \label{ssec:3.5}

The centralized components of the Euro 2.0 prototype are built with traditional client server architecture. Currently these are maintained by the Euro 2.0 Foundation, but would ideally be given over to government or the central bank to run their own monetary system. We only give a high level overview of the centralized component architecture, not going into any significant details of their implementation. At the time of the writing the components are based off of an unfinished prototype with quite a few bugs and some components not yet built. The goal of the subsection is to describe how the centralize components could be set up in such a system, where are the important keys and data are held, and in \hypersectionref{ssec:3.6} how these components interact with the client and Ethereum to fulfill the features described in \hypersectionref{ssec:3.2}.

\subsubsection{Client} \label{sssec:3.5:client}
For our purposes the client refers to code running on a user's device interacting with the Euro 2.0 system. This can be a smart phone application or laptop browser. This is typically Javascript displaying the UI and making HTTP REST calls to the servers for interactions with the system. In the current prototype the client library does not interact directly with the decentralized components, but goes through the servers for all actions. The client will typically be storing a user's private keys in order to access their EUR2 funds.

\subsubsection{ID Server} \label{sssec:3.5:idServer}
The ID server is an interface to all the ID operations of the system. It's main functions include:

\begin{itemize}
	\item Authorization process for ID card, mobile ID, or bank transfer
	\item Approving addresses authorized by an ID
	\item Maintaining the mapping between addresses and ID
	\item Create and Claim Escrowed funds to an ID
	\item Addresses and keys backup system for an ID
\end{itemize}

\subsubsection{ID Database} \label{sssec:3.5:idDatabase}

The ID Database holds the data needed for the ID server. The tables include:

\begin{center}
\begin{tabular}{ | l | p{10cm} | }
 \hline
 \textbf{backup\_challenge} & ...
 \\ \hline\hline
 id\_code & ...
 \\ \hline
 plaintext & ...
 \\ \hline
 encrypted & ...
 \\ \hline
 active & ...
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Id Database Backup Challenge Table}
\label{tab:idDatabaseBackupChallenge}

\begin{center}
\begin{tabular}{ | l | p{10cm} | }
 \hline
 \textbf{escrow} & ...
 \\ \hline\hline
 id\_code & ...
 \\ \hline
 private\_key & ...
 \\ \hline
 address & ...
 \\ \hline
 cleared & ...
 \\ \hline
 clearing\_hash & ...
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{ID Database Escrow Table}
\label{tab:idDatabaseEscrow}

\begin{center}
\begin{tabular}{ | l | p{10cm} | }
 \hline
 \textbf{ethereum\_account} & ...
 \\ \hline\hline
 owner\_id & ...
 \\ \hline
 address & ...
 \\ \hline
 activated & ...
 \\ \hline
 creation\_time & ...
 \\ \hline
 modification\_time & ...
 \\ \hline
 authorisation\_type & ...
 \\ \hline
 transaction\_hash & ...
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{ID Database Ethereum Address Table}
\label{tab:idDatabaseEthereumAddress}

\begin{center}
\begin{tabular}{ | l | p{10cm} | }
 \hline
 \textbf{ethereum\_account} & ...
 \\ \hline\hline
 key\_backup & ...
 \\ \hline
 challenge & ...
 \\ \hline
 address & ...
 \\ \hline
 key\_enc & ...
 \\ \hline
 active & ...
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{ID Database Key Backup Table}
\label{tab:idDatabaseKeyBackup}

\begin{center}
\begin{tabular}{ | l | p{10cm} | }
 \hline
 \textbf{ethereum\_account} & ...
 \\ \hline\hline
 ldap\_response & ...
 \\ \hline
 id\_code & ...
 \\ \hline
 first\_name & ...
 \\ \hline
 last\_name & ...
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{ID Database LDAP Response Table}
\label{tab:idDatabaseLdapResponse}

\begin{center}
\begin{tabular}{ | l | p{10cm} | }
 \hline
 \textbf{pending\_authorisation} & ...
 \\ \hline\hline
 auth\_identifier & ...
 \\ \hline
 type & ...
 \\ \hline
 address & ...
 \\ \hline
 serialised\_mobile\_id\_session & ...
 \\ \hline
 creation\_time & ...
 \\ \hline
 modification\_time & ...
 \\ \hline
 bank\_transfer\_payment\_reference & ...
 \\ \hline
\end{tabular}
\end{center}
\captionof{table}{ID Database Pending Authorization Table}
\label{tab:idDatabasePendingAuthorization}

\subsubsection{SK LDAP Directory Service}

Estonian certificate center (SK)\cite{aboutSk2017} provides an LDAP (Lightweight Directory Access Protocol) server to look up public certificates and legal name for a given Estonia ID number\cite{skAboutLdap2017}\cite{skLdapTechnical2017}. This service is the provider for ID server to look up real names given an Estonian ID code.

\subsubsection{SK DigiDocService}

Estonian certificate center (SK) provides a DigiDocService which allows registered services to provide the ability for users to authenticate themselves with Estonian Mobile-ID or ID card\cite{skDigiDocService2017}. This service is the provider for ID Server to authenticate users using their Mobile ID or Estonian ID card.

\subsubsection{Wallet Server} \label{sssec:3.5:walletServer}

Wallet server is the main entry point for conveniently creating transactions in the Euro 2.0 system and retrieving data from Etherum. It provides the following functionality:

\begin{itemize}
	\item Get transaction info for a transaction hash
	\item Create delegated transfer to another an approved address where the server pays the ether
	\item Create transfer to a bank account via a delegated transfer to the reserve bank
	\item Get address status, balance, and delegate transfer nonce
	\item Get all transfers involving an address
	\item Get transfer fees in EUR2
	\item Get supply amount
\end{itemize}

\subsubsection{Transfer Details Server} \label{sssec:3.5:transferDetailsServer}

Transfer info server has a single purpose of saving transfer info for transactions off chain. It provides a general purpose interface that is up to the client to ensure proper encryption of transfer details so that sender and recipient can view the details. The functionality is simply:

\begin{itemize}
	\item Save transfer details for a transaction hash
	\item Load transfer details for a transaction hash
\end{itemize}

\subsubsection{Transfer Info Database} \label{sssec:3.5:transferInfoDatabase}

This is the database providing for the Transfer Info Server. It's simply a key value store with transaction hash as the key and a blob of data as the value (reference implementation is Google's LevelDB).

\subsubsection{Bank Gateway} \label{sssec:3.5:bankGateway}

The Bank Gateway is the entry point for the real euros in Euro 2.0. The functionality includes:

\begin{itemize}
	\item Update total reserve from uploaded bank statement files
	\item Update total supply
	\item Parse received EUR transactions and send EUR2 to addresses
	\item Handle EUR2 to EUR payments
\end{itemize}

\subsubsection{AML Server} \label{sssec:3.5:amlServer}

The AML server provides the functionality to law enforcement to police the system, including:

\begin{itemize}
	\item Convenience interface for freezing and seizing funds
	\item Convenience interface for accessing AML database
	\item Runs jobs to fill AML database with transaction data
	\item Runs name check jobs on user identities
\end{itemize}

\subsubsection{AML Database} \label{sssec:3.5:amlDatabase}

The AML database provides law enforcement the transaction and identity data needed for AML investigations.

\subsubsection{Ethereum Gateway} \label{sssec:3.5:ethereumGateway}

The Ethereum Gateway is an ethereum full node able to process Ethereum JSON-RPC calls to post and receive data from the Ethereum network. All RPC calls from centralized components go through this interface.

\subsection{Fulfillment of Features} \label{ssec:3.6}

\todo[inline]{Write how the features are fulfilled (with many many diagrams)}

\pagebreak

%--------------------CHAPTER 4-----------------
\section{Chapter 4} \label{sec:4}

\todo[inline]{Write Chapter 4}

\begin{quoting}
	\textbf{RQ2:} How does adoption of Euro 2.0 digital currency impact the relationship with money for key stakeholders: users, merchants, governments, and financial institutions?
\end{quoting}

\begin{quoting}
	\textbf{RQ2.1: }\textit{What is the current relationship of money for stakeholders?}
\end{quoting}
\begin{quoting}
	\textbf{RQ2.2: }\textit{What changes in the relationship of money for stakeholders after adopting the Euro 2.0 digital currency?}
\end{quoting}
\begin{quoting}
	\textbf{RQ2.3: }\textit{What are the enabling and inhibiting factors influencing the transition to the Euro 2.0 digital currency}
\end{quoting}

\pagebreak

%--------------------CHAPTER 5-----------------
\section{Chapter 5} \label{sec:5}

\subsection{Introduction} \label{ssec:5:intro}

After explaining the features and implementation details of the Euro 2.0 system in \hypernameref{sec:3} and exploring the change in relationship with money of stakeholders \hypernameref{sec:4}, we are ready to analyze the risks of Euro 2.0 system. This chapter answers the research question:

\begin{quoting}
	\textbf{RQ3:} \textit{How do we assess the security and privacy risks of Euro 2.0 digital currency system and potential impact on stakeholders?}
\end{quoting}

In which we explore in the sub research questions:
\begin{quoting}
	\textbf{RQ3.1: }\textit{What are risk criteria for the digital currency consistent with the mission of the foundation?}
\end{quoting}
\begin{quoting}
	\textbf{RQ3.2: }\textit{What are the information assets and asset containers of the digital currency?}
\end{quoting}
\begin{quoting}
	\textbf{RQ3.3: }\textit{What are the threats and risks of the digital currency and consequences to stakeholders?}
\end{quoting}
\begin{quoting}
	\textbf{RQ3.4: }\textit{What are the mitigation strategies or alternative design suggestions for the Euro 2.0 system?}
\end{quoting}

\textit{RQ3.1} through \textit{RQ3.4} are answered by applying Steps 1 through 8 of the OCTAVE Allegro risk assessment methodology\cite{CaralliIntroducingOCTAVE2007} to the system described in \hypernameref{sec:3}. \hypersectionref{ssec:5.1} answers \textit{RQ3.1} by establishing a risk measurement criteria consistent with the values of the Euro 2.0 foundation. \hypersectionref{ssec:5.2} works through constructing information asset profiles and identifying information asset containers to answer \textit{RQ3.2}. In \hypersectionref{ssec:5.3} we identify areas of concern and threat scenarios to construct comprehensive information asset risk profiles, answering \textit{RQ3.3}. \hypersectionref{ssec:5.4} users the risk profiles to perform a risk analysis and propose mitigation strategies and design suggestions answering \textit{RQ3.4}. Finally from the above analysis we can make conclusions of the overall risks in Euro 2.0 to answer \textit{RQ3} and also suggest further avenues of research in the \hyperref[ssec:5.5]{Conclusion}.

The OCTAVE Allegro risk assessment was chosen for its simplicity and organization value based risk analysis methodology. The literature was interpreted for application to the Euro 2.0 System and Foundation with assumptions on hypothetical organization structure when the system is production ready. For the risk assessment, user represents both personal users and merchants in the Euro 2.0 digital currency.

\subsection{Foundation and Risk Criteria} \label{ssec:5.1}
In this section we perform \textit{Step 1 - Establish Risk Measurement Criteria} of the OCTAVE Allegro risk assessment. The main outcome of this section is a description of the theoretical organization structure of the Euro 2.0 foundation, its business objectives, and a set of impact areas with risk measurement criteria to be used as the basis of the risk analysis in subsequent sections.

\subsubsection{Foundation Mission and Objectives} \label{sssec:5.1:objectives}

The Euro 2.0 Foundation is a non profit initiative to bring transparency and friction to the monetary system through digital currency. In order for the system to reach wide spread adoption and be financially sustainable, it must be completely taken over and supported by the government. Throughout the risk analysis we will refer to the \textit{Euro 2.0 Foundation} as the government entity responsible for launching and maintaining this government backed digital currency. In the OCTAVE Allegro risk assessment, we interpret all references to Business and Organization to mean the Euro 2.0 Foundation.

The Euro 2.0 Foundation mission is to \textit{``Reduce friction in transfer of value in the economy by unlocking the power of digital currency''}. It's objectives are:

\begin{itemize}
	\item Provide the means to conveniently secure and use digital currency for users and merchants
	\item Avoid for profit financial intermediaries to reduce costs
	\item Be fully compliant with AML and CTF regulations
	\item Interoperate with the existing financial system
\end{itemize}

The organization is structured with the following functions:

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | p{12cm} | }
 \hline
 Unit & Function
 \\ \hline\hline
 Reserve Bank & Manage the conversion between EUR and EUR2 as well as the creation and destruction of EUR2.
 \\ \hline
 Identity & Manage the ID to address mapping and approval of users to the system, communication with Estonian ID servers, as well as user key backups and escrow transactions.
 \\ \hline
 Law Enforcement & Manage the AML proccesses, seizing, and freezing of funds.
 \\ \hline
 Usability & Responsible for building the clients to use the system and maintaining convenience servers as well as the delegate transaction mechanism.
 \\ \hline
 Ethereum & Responsible for building, deploying, and maintaining the Ethereum smart contract and full node used to to communicate with the Ethereum network. Also assists other departments in managing private admin keys.
 \\ \hline
\end{tabular}
}
\end{center}
\captionof{table}{Euro 2.0 Organization Structure}
\label{tab:organizationStructure}

\subsubsection{Defining Risk Measurement Criteria} \label{sssec:5.1:defining}

OCTAVE Allegro Step 1 Activity 2 is the definition of a qualitative set of impact areas with risk measurement criteria to the foundation. Each impact area is a factor in the risk analysis in \hypersectionref{ssec:5.4}. The supplemented impact areas by the OCTAVE Allegro framework were used as a starting point for defining the impact areas specifically for Euro 2.0, although most of the resulting impact areas were created specifically for this risk assessment. \hypertableref{tab:riskImpactAreas} lists the final risk measurement impact areas:

\begin{center}
\begin{tabular}{ | l | l |}
  \hline
  \textbf{Impact Area} & \textbf{Symbol}
  \\ \hline
  Reputation & R
  \\ \hline
  One Time Monetary Loss for a User & M
  \\ \hline
  One Time Financial Loss for the Foundation & F
  \\ \hline
  Fines and Legal Penalties & L
  \\ \hline
  Privacy - User Financial Information Revealed & P
  \\ \hline
  Availability - Payments Network Unusable & A
  \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Risk Impact Areas}
\label{tab:riskImpactAreas}

Each impact area has criteria for levels not applicable (N/A), low, medium, and high. The N/A level is not part of the OCTAVE Allegro methodology, but was added to this risk assessment so that final risk analysis rankings were not skewed by risks that don't affect the impact areas. The derivation of these impact areas and the their risk measurement criteria levels are described in more details below.

\paragraph{Ignored Impact Areas}

OCTAVE suggested impact areas Productivity and Safety and Health were not included in the Euro 2.0 risk assessment. Productivity is not applicable since there is no clear measurable output of the Foundation based off of human hours. Safety and Health are not applicable since the Foundation does not have any physical proccesses or strenuous activities that reasonably need consideration in a security risk assessment.

\paragraph{(R) Reputation}

\textit{Reputation} is derived from the \textit{Reputation and Customer Confidence} Allegro Worksheet 1. This impact area describes the loss of user confidence in the Euro 2.0 Foundation and subsequent difficulty in attracting users following a realized risk in this area. From this worksheet, Customer Loss was also considered to be included as an impact area rebranded as \textit{Loss of User Acquisition Rate}, but was not included because of the lack of meaningful way to measure its current level and expected change as a realized risk, making it no different than reputation. \hypertableref{tab:reputationRiskCriteria} describes the levels for this impact area.

\begin{center}
\begin{tabular}{ | l | p{12cm} | }
  \hline
  \multicolumn{2}{|c|}{\textbf{(R) Reputation}}
  \\ \hline
  \textbf{N/A} & No impact on reputation.
  \\ \hline
  \textbf{Low} & Reputation is minimally affected. Little or no effort or expense is required to recover.
  \\ \hline
  \textbf{Medium} & Reputation is damaged, and some effort and expense is required to recover.
  \\ \hline
  \textbf{High} & Reputation is irrevocably destroyed or damaged.
  \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Reputation Risk Criteria}
\label{tab:reputationRiskCriteria}

\paragraph{(M) One Time Monetary Loss for a User}

\textit{One Time Monetary Loss for a User} started as an \textit{Other} fill in impact area in \textit{Risk Measurement Criteria - Reputation and Customer Confidence} Allegro Worksheet 1. This impact area represents the concern of Euro 2.0 users about the safety of their money, an important aspect of a monetary system. \hypertableref{tab:userMonetaryLossRiskCriteria} describes the levels for this impact area.

\begin{center}
\begin{tabular}{ | l | p{12cm} | }
  \hline
  \multicolumn{2}{|c|}{\textbf{(M) One Time Monetary Loss for a User}}
  \\ \hline
  \textbf{N/A} & No user monetary loss, 0 EUR.
  \\ \hline
  \textbf{Low} & User monetary loss less than 100 EUR.
  \\ \hline
  \textbf{Medium} & User monetary loss between 100 and 1000 EUR inclusive.
  \\ \hline
  \textbf{High} & User monetary loss greater than 1000 EUR.
  \\ \hline
\end{tabular}
\end{center}
\captionof{table}{One Time Monetary Loss for a User Risk Criteria}
\label{tab:userMonetaryLossRiskCriteria}

The loss amounts in the risk criteria are arbitrary and for approximate qualitative representation. The Low level represents the loss of a single transaction or daily spending amount, the Medium level represents the loss of a monthly salary of spending, while the High level represents the loss of a savings account or the total account.

\paragraph{(F) One Time Financial Loss for the Foundation}

\textit{One Time Financial Loss for the Foundation} is the only prescribed impact area from the \textit{Risk Measurement Criteria - Financial} Allegro Worksheet 2. This impact area describes the one time monetary losses the Euro 2.0 Foundation is liable for based on realized risks. \textit{Operating Costs} did not make sense to include due to the lack of financials about the projected operating costs of the Euro 2.0 Foundation. \textit{Revenue Loss} doesn't make sense to include since this is currently a non-profit initiative without the intention of revenue. The risk measurement criteria for this impact area are described in \hypertableref{tab:foundationFinancialLossRiskCriteria}.

\begin{center}
\begin{tabular}{ | l | p{12cm} | }
  \hline
  \multicolumn{2}{|c|}{\textbf{(F) One Time Financial Loss for the Foundation}}
  \\ \hline
  \textbf{N/A} & No one time financial loss.
  \\ \hline
  \textbf{Low} & One time financial loss of less than 1000 EUR.
  \\ \hline
  \textbf{Medium} & One time financial loss between 1000 and 10000 EUR.
  \\ \hline
  \textbf{High} & One time financial loss greater than 10000 EUR.
  \\ \hline
\end{tabular}
\end{center}
\captionof{table}{One Time Financial Loss for the Foundation Risk Criteria}
\label{tab:foundationFinancialLossRiskCriteria}

The loss amounts in the risk criteria are arbitrary and for approximate qualitative representation. The Low level represents the loss easily covered from a 50 to 100 EUR donation by 10 to 20 members of the Foundation. The Medium level represents a loss that would be significantly challenge for Foundation members requiring possibly a debt payed back over a few months. While the High level represents a possibly crippling loss to the organization, possibly resulting in bankruptcy.

\paragraph{(L) Fines and Legal Penalties}

\textit{Fines and Legal Penalties} came directly from the \textit{Risk Measurement Criteria - Fines and Legal Penalties} Allegro Worksheet 3. This impact area describes the monetary losses from penalties the Euro 2.0 Foundation would be liable for from realized risks. \textit{Fines} and \textit{Lawsuits} from the worksheet were combined into one impact area in this risk assessment since there is not enough existing knowledge to really distinguish the two impact areas in risk profiling. The risk measurement criteria for this impact area are described in \hypertableref{tab:legalRiskCriteria}.

\begin{center}
\begin{tabular}{ | l | p{12cm} | }
  \hline
  \multicolumn{2}{|c|}{\textbf{(L) Fines and Legal Penalties}}
  \\ \hline
  \textbf{N/A} & No legal financial loss.
  \\ \hline
  \textbf{Low} & Legal financial loss of less than 1000 EUR.
  \\ \hline
  \textbf{Medium} & Legal financial loss between 1000 and 10000 EUR.
  \\ \hline
  \textbf{High} & Legal financial loss of user greater than 10000 EUR.
  \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Legal - Fines and Lawsuits Risk Criteria}
\label{tab:legalRiskCriteria}

The amounts are arbitrary and derived from the same reasoning as \textit{One Time Financial Loss for the Foundation}.

\paragraph{(P) - Privacy - User Financial Information Revealed}

\textit{Privacy - User Financial Information Revealed} is a user defined impact area from \textit{Risk Measurement Criteria - User Defined} Allegro Worksheet 6. The risk criteria qualifies the amount of customers with personally identifiable financial data disclosed. Users knowing about their financial data disclosed are likely to encourage other users to not use the Euro 2.0 system. The risk criteria are explained in \hypertableref{tab:privacyRiskCriteria}.

\begin{center}
\begin{tabular}{ | l | p{12cm} | }
  \hline
  \multicolumn{2}{|c|}{\textbf{(P) Privacy - User Financial Information Revealed}}
  \\ \hline
  \textbf{N/A} & No users with disclosed personally identifiable financial information.
  \\ \hline
  \textbf{Low} & A few users (less than 10) with disclosed personally identifiable financial information.
  \\ \hline
  \textbf{Medium} & Many users (between 10 and 1000) with personally identifiable financial information.
  \\ \hline
  \textbf{High} & All users in the system with disclosed personally identifiable financial information.
  \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Privacy - User Financial Information Revealed Risk Criteria}
\label{tab:privacyRiskCriteria}

\paragraph{(A) - Availability - Payments Network Unusable}

\textit{Availability - Payments Network Unusable} is a user defined impact area from \textit{Risk Measurement Criteria - User Defined} Allegro Worksheet 6. The risk criteria qualifies the level of disruption to payment operations of users in the system. Users who cannot use the payments network will quickly lose trust in it for their financial needs. The risk criteria are explained in \hypertableref{tab:availabilityRiskCriteria}.

\begin{center}
\begin{tabular}{ | l | p{12cm} | }
  \hline
  \multicolumn{2}{|c|}{\textbf{(A) Availability - Payments Network Unusable}}
  \\ \hline
  \textbf{N/A} & No disruption to usability of network (1-60 seconds per payment operation).
  \\ \hline
  \textbf{Low} & Some disruption, 1 to 5 minute delay for payment operations.
  \\ \hline
  \textbf{Medium} & Noticeable disruption, 5 to 60 minute delay for payment operations.
  \\ \hline
  \textbf{High} & Sever disruption, more than 60 minute delay for payment operations.
  \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Availability - Payments Network Unusable Risk Criteria}
\label{tab:availabilityRiskCriteria}


\subsubsection{Ranking Risk Measurement Criteria} \label{sssec:5.1:ranking}

Activity 2 of Step 1 of OCTAVE Allegro is prioritization of the risk criteria determined in Activity 1. \hypertableref{tab:riskCriteriaRanking} shows the rank risk criteria of Euro 2.0 ranked with 6 as the highest and 1 as the lowest.

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | p{10cm} | }
  \hline
  \textbf{Ranking} & \textbf{Abbreviation} & \textbf{Name}
  \\ \hline
  6 & M & One Time Monetary Loss for a User
  \\ \hline
  5 & R & Reputation
  \\ \hline
  4 & P & Privacy - User Financial Information Revealed
  \\ \hline
  3 & A & Availability - Payments Network Unusable
  \\ \hline
  2 & F & One Time Financial Loss for the Foundation
  \\ \hline
  1 & L & Fines and Legal Penalties
  \\ \hline
\end{tabular}
}
\end{center}
\captionof{table}{Risk Criteria Ranking}
\label{tab:riskCriteriaRanking}

The most important risk criteria are those that are significant detractors to user growth of the new digital currency. The financial livelihood of the user (\textbf{M}) is at the top of the list. A realized risk resulting in monetary loss of the user will likely lose the user and negative virality (user telling his friends Euro 2.0 is risky) will prevent other users from joining.  The reputation of the organization and monetary confidence (\textbf{R}) is next in the line as a realized risk here discourages users from joining. Next is the privacy of users (\textbf{P}) which also encourages a negative user experience and detracts growth if significantly breached. Next is the availability (\textbf{A}) system. Finally, the least important of the risk criteria, is the financial losses of the organization (\textbf{F}) and legal fines and lawsuits (\textbf{L}). Mistakes are likely to happen, as long as the foundation is still alive, there is more value at the start to ensure user happiness and growth.

\subsection{Information Assets and Containers} \label{ssec:5.2}

In this section we define the information assets and asset containers following \textit{Step 2 - Develop an Information Asset Profile} and \textit{Step 3 - Identify Information Asset Containers} of the OCTAVE Allegro Risk Assessment. These information assets and asset containers are the main subject of risk profiles constructed in \hypersectionref{ssec:5.3} which are analyzed and mitigated \hypersectionref{ssec:5.4}. First we walk through defining the possible information assets of Euro 2.0. Next we narrow down to a \textit{critical few} information assets to be the subject of the risk analysis. Then for each critical information assets, we build a full profile with information asset containers.

\subsubsection{Enumerating Information Assets} \label{sssec:5.2:enumeratingAssets}

An \textit{Information Asset} is any information or data that can be valuable to the foundation existing in either electronic or physical form. Enumerating information assets can be done by answering the following questions\cite{CaralliIntroducingOCTAVE2007}:

\begin{itemize}
	\item ``What information assets are of most value to your organization?''
	\item ``What information assets are used in day-to-day work processes and operations?''
	\item ``What information assets, if lost, would significantly disrupt your organization’s ability to accomplish its goals and contribute to achieving the organization’s mission?''
	\item ``What other assets are closely related to these assets?''
\end{itemize}

In which we enumerate the following information assets for Euro 2.0 in \hypertableref{tab:informationAssets}:

\begin{center}
\begin{tabular}{ | p{6cm} | p{8cm} | }
  \hline
  \textbf{Information Asset} & \textbf{Description}
  \\ \hline
  Reserve Bank Account Access & Used to access funds sent to and from the reserve bank account.
  \\ \hline
  \specialcell{
  	Ethereum Contract Data: \\
	\quad Status \\
	\quad Balance \\
	\quad Delegate Transfer Nonce \\
	\quad Recovery Account \\
	\quad Total Supply \\
  } & All of the decentralized data of the Euro 2.0 system.
  \\ \hline
  \specialcell{
  	Ethereum Admin Keys: \\
  	\quad Master Account Key \\
  	\quad Reserve Key \\
  	\quad Account Approver Key \\
	\quad Enforcement Key \\
  	\quad Designator Key \\
  	\quad Delegate Key \\
  } & The keys to all the special admin functions of the Euro 2.0 system.
  \\ \hline
  \specialcell{DB Credentials: \\
    \quad ID \\
	\quad AML \\
    \quad Transfer Info \\
    \quad Bank Gateway \\
  } & The credentials to the traditional centralized databases of the Euro 2.0 system.
  \\ \hline
  Customer Keys & Ethereum address private keys for the customer to access their money.
  \\ \hline
  \specialcell{Customer Data: \\
  	\quad Sender and Receiver Identities \\
  	\quad Reserve Bank Transaction Data \\
  	\quad Backup Keys \\
  	\quad ID $\Leftrightarrow$ Address Mapping \\
  	\quad Escrow Data \\
  	\quad Bank Transaction Data
  } & Various customer data.
  \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Euro 2.0 Possible Information Assets}
\label{tab:informationAssets}

\subsubsection{Selecting Critical Information Assets} \label{sssec:5.2:criticalAssets}

The ``critical few'' information assets are those that have a significant adverse affect on the organization if disclosed, modified, lost, destroyed, or access interrupted. From the list of enumerated information is derived the critical information assets:

\begin{enumerate}[(I)] \label{enum:criticalInformationAssets}
	\item User Money
	\item Ethereum Admin Keys
	\item User Identity
\end{enumerate}

These are chosen as critical information assets to be representative of the majority of information assets enumerated in \hypertableref{tab:informationAssets}. Limiting the number of critical information assets reduces the number of risk profiles in \hypersectionref{ssec:5.3} and simplifies the complexity of the risk analysis in \hypersectionref{ssec:5.4}. \textit{Ethereum Contract Data} and \textit{User Keys} were also considered as critical information assets but are adequately represented by \textit{User Money}. \textit{User Transfer History} was also considered as a critical information asset but is heavily related enough to \textit{User Identity} to disregard.

\subsubsection{Information Asset and Containers Analysis} \label{sssec:5.2:analysis}

The following subsections describe in detail the critical information asset profiles and information assets containers for \hyperref[sssec:5.2:userMoney]{User Money}, \hyperref[sssec:5.2:ethereumAdminKeys]{Ethereum Admin Keys}, and \hyperref[sssec:5.2:userIdentity]{User Identity} that will be the basis of enumerating risk profiles in \hypersectionref{ssec:5.3} .

Allegro Worksheet 8 summarizes the key aspects of a \textit{Critical Information Asset Profile} filled out during \textit{Step 2 - Develop Information Asset Profile}. The Asset Profile includes information about the asset, rationale for selection, organizational description, owners, and security requirements. The security requirements characterize how an information asset is to be protected and are key for evaluating impact of risks. Security requirements of information assets are explained in \hypertableref{tab:securityRequirements}.

\begin{center}
\begin{tabular}{ | l | p{10.5cm} | }
  \hline
  \textbf{Security Requirement} & \textbf{Description}
  \\ \hline
  Confidentiality & Ensuring that only authorized people or systems have access to the information asset
  \\ \hline
  Integrity & Ensuring that an information asset remains in the condition that was intended by the owner and for the purposes intended by the owner.
  \\ \hline
  Availability & Ensuring that the information asset remains accessible to authorized users.
  \\ \hline
\end{tabular}
\end{center}
\captionof{table}{Security Requirements of Information Assets}
\label{tab:securityRequirements}

\textit{Information Asset Containers} are where an information assets are stored, transported, or processed. \textit{``In an information security risk assessment, the identification of containers is essential to identifying risks to the information asset itself.''} They are they key points of vulnerability and threats as well as the key points to apply mitigations and preventive measures for an information asset. An information asset containers can be technical, physical, or people and internal or external to the organization.  In the context of Euro 2.0 risk analysis we focus mainly on technical and people asset containers. Three important points about the security of information assets with regards to information asset containers:

\begin{enumerate}
	\item The \textbf{way} in which an information asset is protected or secured is through controls implemented an the container level.
	\item The \textbf{degree} in which an information asset is protected or secured is based on how well the controls are implemented at the container level.
	\item Any \textbf{vulnerabilities} and \textbf{threats} to the container in which the information asset lives are inherited by the information asset.
\end{enumerate}

The information asset containers for the \hyperref[enum:criticalInformationAssets]{critical information assets} were identified by working through OCTAVE Allegro \textit{Step 3 - Identify Information Asset Containers} and listed in the description of critical information asset profiles in subsections \ref{sssec:5.2:userMoney}, \ref{sssec:5.2:ethereumAdminKeys}, and \ref{sssec:5.2:userIdentity}.

\subsubsection{Critical Asset I: User Money} \label{sssec:5.2:userMoney}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | p{5cm} | p{12cm} | }
  \hline
  \textbf{(1) Critical Asset} & User Money
  \\ \hline
  \textbf{(2) Rationale for Selection} & User money is the most important information asset for users of a digital currency and Euro 2.0 and must be secured. Discrepancy of balance of money undermines the entire usefulness of Euro 2.0. This asset is definitely subject to regulatory requirements but out of scope of this thesis.
  \\ \hline
  \textbf{(3) Description} & This is money, including the EUR and EUR2 holdings of users, merchants, and other admin accounts as they enter, reside, and leave the Euro 2.0 system.
  \\ \hline
  \textbf{(4) Owners} & Ultimately ownership of user, merchant, and admin funds are the respective parties. While EUR2 is being held and transacted in the system, an equivalent amount of EUR is held and shared ownership by the Reserve.
  \\ \hline
  \textbf{(5) Security Requirements} &
  	\hskip-0.2cm
  	\begin{tabular}{p{2.5cm}|p{9.06cm}}
		\textbf{Confidentiality} & Only the owner of funds should be able to use them. By design the amount of funds is not confidential but the owner of the funds should be (which is critical Asset III).
		\\ \hline
		\textbf{Integrity} & 100\% this asset should never change against rules.
		\\ \hline
		\textbf{Availability} & Ideally available more than 99\% of the time, but not super important.
	\end{tabular}
  \\ \hline
  \textbf{(6) Most Important Security Requirement} & \textbf{Integrity}. Money being created and destroyed arbitrary completely undermines the system.
  \\ \hline
\end{tabular}
}
\end{center}
\captionof{table}{User Money Asset Profile}
\label{tab:assetProfileUserMoney}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | l | p{10cm} |}
  \hline
  \textbf{Container} & \textbf{Type} & \textbf{Owners} & \textbf{Description}
  \\ \hline
  Wallet Server & \specialcell{Technical \\ Internal} & Convenience Department & The wallet service performs the EUR2 delegate transfer operation. 
  \\ \hline
  ID Server & \specialcell{Technical \\ Internal} & Identity Department & The ID server currently handles escrow of funds to an ID and addresses and keys backup.
  \\ \hline
  Bank Gateway Server & \specialcell{Technical \\ Internal} & Reserve Department & The bank gateway server handles the conversion from EUR to EUR2.
  \\ \hline
  Ethereum Node & \specialcell{Technical \\ Internal} & Ethereum Department & This node is the interface to all the operations with the Ethereum network.
  \\ \hline
  User Client & \specialcell{Technical \\ External} & \specialcell{User \\ Foundation} & User's device to interact with the Euro 2.0 system.
  \\ \hline
  Ethereum Smart Contracts & \specialcell{Technical \\ External} & \specialcell{No Owner \\ Ethereum Department} & Deployed smart contracts on Ethereum Blockchain that hold all of the decentralized balance and account data and operations in the system.
  \\ \hline
  Reserve Bank Account & \specialcell{Technical \\ External} & \specialcell{A Bank \\ Reserve Department} & Bank account used for all EUR operations.
  \\ \hline
  Reserve Bank Account Admin & \specialcell{People \\ Internal} & Reserve Department & Bank account used for all EUR operations.
  \\ \hline
  Internet & \specialcell{Technical \\ External} & No owner & Communication channel for all communication between all components.
  \\ \hline
\end{tabular}
}
\end{center}
\captionof{table}{User Money Asset Containers}
\label{tab:assetContainersUserMoney}

\subsubsection{Critical Asset II: Ethereum Admin Keys} \label{sssec:5.2:ethereumAdminKeys}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | p{5cm} | p{12cm} | }
  \hline
  \textbf{(1) Critical Asset} & The Ethereum Admin keys are those ethereum address keys that control the critical functionality inside the Euro 2.0 smart contracts.
  \\ \hline
  \textbf{(2) Rationale for Selection} & The core of the monetary system is controlled with these keys. Deploying and changing new contracts and rules of how data can be read and written. A compromised admin key could prove devastating for the entire system.
  \\ \hline
  \textbf{(3) Description} &
  	\specialcell {
		These are electronically generated cryptographic keys. \\
		The admin keys and functions include: \\
		\quad \textit{CryptoFiat Master} - can deploy and upgrade contracts \\
		\quad \textit{Reserve} - can manage supply, create and destroy money \\
		\quad \textit{Approver} - can approve addresses \\
		\quad \textit{Delegate} - can sign delegate transfers on behalf of wallet server \\
		\quad \textit{Enforcement} - can freeze accounts and seize funds \\
		\quad \textit{Designator} - can access seized funds
	}
  \\ \hline
  \textbf{(4) Owners} & \specialcell {
  	Each key is owned by a different part of the \hyperref[tab:organizationStructure]{Euro 2.0 Foundation}: \\
	\quad \textit{CryptoFiat Master} - Ethereum department \\
	\quad \textit{Reserve} - Reserve department \\
	\quad \textit{Approver} - Identity department \\
	\quad \textit{Delegate} - Convenience department \\
	\quad \textit{Enforcement} - Law Enforcement Department \\
	\quad \textit{Designator} - Law Enforcement Department
  }
  \\ \hline
  \textbf{(5) Security Requirements} &
  	\hskip-0.2cm
  	\begin{tabular}{p{2.5cm}|p{9.06cm}}
		\textbf{Confidentiality} & This asset must be key utmost confidential.
		\\ \hline
		\textbf{Integrity} & Keys don't work if they are modified so this is quite important.
		\\ \hline
		\textbf{Availability} & Approver, Delegate, and Reserve need to be available most of the time for operations. Enforcement and Designator only need to be available during these rare operations. CryptoFiat master only needs to be available on deploys.
	\end{tabular}
  \\ \hline
  \textbf{(6) Most Important Security Requirement} & \textbf{Confidentiality}. Without a question a breach of confidentiality of the keys is devastating to the digital currency.
  \\ \hline
\end{tabular}
}
\end{center}
\captionof{table}{Ethereum Admin Keys Asset Profile}
\label{tab:assetProfileEthereumAdminKeys}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | l | p{10cm} |}
  \hline
  \textbf{Container} & \textbf{Type} & \textbf{Owners} & \textbf{Description}
  \\ \hline
  Key Generating Device & \specialcell{Technical \\ Internal} & Ethereum Department & The device used to generate an Ethereum admin key and address.
  \\ \hline
  Key File & \specialcell{Technical \\ Internal} & Depends on Key & File used to store Ethereum private key.
  \\ \hline
  Physical Backup of Key & \specialcell{Physical \\ Internal} & Depends on Key & Physical backup of admin key.
  \\ \hline
  Key Encryption Password & \specialcell{People \\ Internal} & Depends on Key & Password used to encrypt and decrypt a key file.
  \\ \hline
  CryptoFiat Master Device & \specialcell{Technical \\ Internal} & Ethereum Department & Device holding the CryptoFiat master key file.
  \\ \hline
  CryptoFiat Master Transactor & \specialcell{Technical \\ Internal} & Ethereum Department & Device used to broadcast master operations to Ethereum network.
  \\ \hline
  Law Enforcement Device & \specialcell{Technical \\ Internal} & Law Enforcement Department & Device holding the Law Enforcement key file.
  \\ \hline
  Designator Device & \specialcell{Technical \\ Internal} & Designator Department & Device holding the Law Enforcement key file.
  \\ \hline
  AML Server & \specialcell{Technical \\ Internal} & Designator Department & Device used to broadcast Law Enforcement and Enforcer operations to the Ethereum network.
  \\ \hline
  Bank Gateway & \specialcell{Technical \\ Internal} & Reserve Department & Device holding the reserve key file used to sign transactions and do operations for the reserve.
  \\ \hline
  ID Server & \specialcell{Technical \\ Internal} & Identity Department & Server holding the approver key file needed to approve addresses for authorized IDs.
  \\ \hline
  Wallet Server & \specialcell{Technical \\ Internal} & Convenience Department & Server holding the delegator key file needed to sign delegate transactions on behalf of users.
  \\ \hline
  Ethereum Node & \specialcell{Technical \\ Internal} & Ethereum Department & This node is the interface to all the operations with the Ethereum network.
  \\ \hline
\end{tabular}
}
\end{center}
\captionof{table}{Ethereum Admin Keys Asset Containers}
\label{tab:assetContainersEthereumAdminKeys}

\subsubsection{Critical Asset III: User Identity} \label{sssec:5.2:userIdentity}


\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | p{5cm} | p{12cm} | }
  \hline
  \textbf{(1) Critical Asset} & User Identity in any format in the Euro 2.0 system.
  \\ \hline
  \textbf{(2) Rationale for Selection} & If the Identity of a user is linked to their Ethereum address, all transaction history is visible on the Ethereum Blockchain under the current implementation.
  \\ \hline
  \textbf{(3) Description} & Identity refers to ID code and any other personally identifiable information.
  \\ \hline
  \textbf{(4) Owners} & The User and partially the Identity department. 
  \\ \hline
  \textbf{(5) Security Requirements} &
  	\hskip-0.2cm
  	\begin{tabular}{p{2.5cm}|p{9.06cm}}
		\textbf{Confidentiality} & Highly confidential, only the ID server, owning user, and other users that have been told that ID code.
		\\ \hline
		\textbf{Integrity} & The ID should be exactly as is for the ID server or user approving an address.
		\\ \hline
		\textbf{Availability} & Only needs to be available when user looks up an address by ID or approves an address.
	\end{tabular}
  \\ \hline
  \textbf{(6) Most Important Security Requirement} & \textbf{Confidentiality} because of the consequences of a server 	
  \\ \hline
\end{tabular}
}
\end{center}
\captionof{table}{User Identity Asset Profile}
\label{tab:assetProfileUserIdentity}

\begin{center}
\resizebox{\textwidth}{!}{
\begin{tabular}{ | l | l | l | p{10cm} |}
  \hline
  \textbf{Container} & \textbf{Type} & \textbf{Owners} & \textbf{Description}
  \\ \hline
  ID Server & \specialcell{Technical \\ Internal} & Identity Department & Manages ID authentication and approval of Ethereum addresses for users.
  \\ \hline
  ID Database & \specialcell{Technical \\ Internal} & Identity Department & Database storing ID to Ethereum address mapping, escrow, and keys backups.
  \\ \hline
  AML Server & \specialcell{Technical \\ Internal} & Law Enforcement Department & Server providing AML operations to Law Enforcement.
  \\ \hline
  AML Database & \specialcell{Technical \\ Internal} & Law Enforcement Department & Database storing transactions, addresses, and IDs for AML analysis.
  \\ \hline
  Ethereum Node & \specialcell{Technical \\ Internal} & Ethereum Department & This node is the interface to all the operations with the Ethereum network.
  \\ \hline
  User Client & \specialcell{Technical \\ External} & \specialcell{User \\ Foundation} & User's device to interact with the Euro 2.0 system.
  \\ \hline
  Ethereum Smart Contracts & \specialcell{Technical \\ External} & \specialcell{No Owner \\ Ethereum Department} & Deployed smart contracts on Ethereum Blockchain that hold all of the decentralized balance and account data and operations in the system.
  \\ \hline
  SK ID LDAP & \specialcell{Technical \\ External} & SK ID Solutions AS & Directory lookup for information based on an Estonian ID number.
  \\ \hline
  SK DigiDocService & \specialcell{Technical \\ External} & SK ID Solutions AS & Estonian ID authentication services.
  \\ \hline
  People & \specialcell{People \\ External} & Anyone & Knowledge of ID numbers can be found in many external proccesses in Estonia.
  \\ \hline
\end{tabular}
}
\end{center}
\captionof{table}{User Identity Asset Containers}
\label{tab:assetContainersUserIdentity}

\subsection{Risk Profiles} \label{ssec:5.3}

\subsection{Risk Analysis and Mitigation} \label{ssec:5.4}

\subsection{Conclusion} \label{ssec:5.5}

\pagebreak

%--------------------CHAPTER 6 - EVALUATION-----------------
\section{Evaluation} \label{sec:6}

\todo[inline]{Write Evaluation (Chapter 6) \ldots}

\pagebreak

%-------------------------------SUMMARY---------------------------
\section{Summary} \label{sec:7}

\todo[inline]{Write Summary (Chapter 7) \ldots}

\pagebreak

%------------------------------Bibliography-----------------------------------
\addcontentsline{toc}{section}{References} \label{sec:refs}
\bibliography{thesis}{References}
\bibliographystyle{plain}
\pagebreak

%-----------------------------APPENDICES--------------------------------
\section*{Appendix A - Files} \label{sec:a}
%\label{Lisa1}
\addcontentsline{toc}{section}{Appendix A - Files}

\subsection*{A.1: Euro 2.0 Codebase} \label{ssec:a.1}
\url{http://github.com/cryptofiat}

\subsection*{A.2: Archive of Cited Web Pages} \label{ssec:a.2}

\subsection*{A.3: Euro 2.0 Contract Codebase} \label{ssec:a.3}
\url{https://github.com/cryptofiat/contract}

\subsection*{A.4: CryptoFiat Contract} \label{ssec:a.4}
\url{https://github.com/cryptofiat/contract/blob/master/CryptoFiat.sol}

\end{document}
